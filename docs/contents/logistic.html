<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.40">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Sungkyun Cho">
<meta name="dcterms.date" content="2025-05-29">

<title>Logistic Regression –  Intro to Data Science</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../contents/lda.html" rel="next">
<link href="../contents/knn.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-3e062e8fe420344c07f1e837915f9541.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark-55b2b16ef464b1d24caa77f57887db60.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-aeea4e2781fea0fa87091c4b8120fd0c.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark-dce1da946abc22c65d6213f1e4fdb336.min.css" rel="prefetch" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script src="../site_libs/quarto-contrib/iconify-2.0.0/iconify-icon.min.js"></script>
<script src="../site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="../site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="../site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-F9XY7W8RLK"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-F9XY7W8RLK', { 'anonymize_ip': true});
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<meta property="og:title" content="Logistic Regression –  Intro to Data Science">
<meta property="og:description" content="Mixed">
<meta property="og:image" content="https://dgds101.modellings.art/contents/images/ols.png">
<meta property="og:site_name" content="Introduction to Data Science">
<meta property="og:image:height" content="970">
<meta property="og:image:width" content="1766">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title"><iconify-icon inline="" icon="fa-solid:fingerprint" aria-label="Icon fingerprint from fa-solid Iconify.design set." title="Icon fingerprint from fa-solid Iconify.design set."></iconify-icon> Intro to Data Science</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-introduction" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Introduction</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-introduction">    
        <li>
    <a class="dropdown-item" href="../contents/intro.html">
 <span class="dropdown-text">Overview</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../contents/two-cultures.html">
 <span class="dropdown-text">Two Cultures</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../contents/setup.html">
 <span class="dropdown-text">Python Setup</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-python-basics" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Python Basics</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-python-basics">    
        <li>
    <a class="dropdown-item" href="../contents/pandas.html">
 <span class="dropdown-text">NumPy &amp; pandas</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../contents/inspection.html">
 <span class="dropdown-text">Data Inspection</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../contents/subsetting.html">
 <span class="dropdown-text">Subsetting</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-eda" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">EDA</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-eda">    
        <li>
    <a class="dropdown-item" href="../contents/vis-intro.html">
 <span class="dropdown-text">Visualize</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../contents/eda.html">
 <span class="dropdown-text">Explore</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../contents/wrangling.html">
 <span class="dropdown-text">Wrangling</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-linear-models" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Linear Models</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-linear-models">    
        <li>
    <a class="dropdown-item" href="../contents/model-basic.html">
 <span class="dropdown-text">Model Basics</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../contents/model-basic-implementation.html">
 <span class="dropdown-text">Implementations</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../contents/statistics.html">
 <span class="dropdown-text">Regression Analysis</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-ml-basics" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">ML Basics</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-ml-basics">    
        <li>
    <a class="dropdown-item" href="../contents/mlsl-intro.html">
 <span class="dropdown-text">Introduction</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../contents/regularization.html">
 <span class="dropdown-text">Regularization</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../contents/shrinkage.html">
 <span class="dropdown-text">Implementations</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../contents/knn.html">
 <span class="dropdown-text">K-Nearest Neighbors</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-classification" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Classification</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-classification">    
        <li>
    <a class="dropdown-item" href="../contents/logistic.html">
 <span class="dropdown-text">Logistic Regression</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../contents/lda.html">
 <span class="dropdown-text">Generative Models</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../contents/tree.html"> 
<span class="menu-text">Trees</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#generalized-linear-models" id="toc-generalized-linear-models" class="nav-link active" data-scroll-target="#generalized-linear-models">Generalized Linear Models</a></li>
  <li><a href="#logistic-regression" id="toc-logistic-regression" class="nav-link" data-scroll-target="#logistic-regression">Logistic Regression</a>
  <ul>
  <li><a href="#emperical-probability-odds" id="toc-emperical-probability-odds" class="nav-link" data-scroll-target="#emperical-probability-odds">Emperical probability/ Odds</a></li>
  <li><a href="#prediction-values" id="toc-prediction-values" class="nav-link" data-scroll-target="#prediction-values">Prediction Values</a></li>
  <li><a href="#predictive-accuracy" id="toc-predictive-accuracy" class="nav-link" data-scroll-target="#predictive-accuracy">Predictive Accuracy</a>
  <ul class="collapse">
  <li><a href="#evaluation-of-predicted-probability" id="toc-evaluation-of-predicted-probability" class="nav-link" data-scroll-target="#evaluation-of-predicted-probability">Evaluation of predicted probability</a></li>
  <li><a href="#evaluation-of-predicted-class" id="toc-evaluation-of-predicted-class" class="nav-link" data-scroll-target="#evaluation-of-predicted-class">Evaluation of predicted class</a></li>
  <li><a href="#분류모형의-성능을-평가하기-위한-여러-지표들" id="toc-분류모형의-성능을-평가하기-위한-여러-지표들" class="nav-link" data-scroll-target="#분류모형의-성능을-평가하기-위한-여러-지표들">분류모형의 성능을 평가하기 위한 여러 지표들</a></li>
  </ul></li>
  <li><a href="#decision-boundary" id="toc-decision-boundary" class="nav-link" data-scroll-target="#decision-boundary">Decision Boundary</a></li>
  <li><a href="#basis-functions" id="toc-basis-functions" class="nav-link" data-scroll-target="#basis-functions">Basis Functions</a></li>
  <li><a href="#neural-networkdeep-learning" id="toc-neural-networkdeep-learning" class="nav-link" data-scroll-target="#neural-networkdeep-learning">Neural Network/Deep Learning</a></li>
  <li><a href="#multiclass-k-2" id="toc-multiclass-k-2" class="nav-link" data-scroll-target="#multiclass-k-2">Multiclass (K &gt; 2)</a>
  <ul class="collapse">
  <li><a href="#blowdown-data" id="toc-blowdown-data" class="nav-link" data-scroll-target="#blowdown-data">Blowdown data</a></li>
  <li><a href="#mnist-digits-data" id="toc-mnist-digits-data" class="nav-link" data-scroll-target="#mnist-digits-data">MNIST digits data</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#other-model-families" id="toc-other-model-families" class="nav-link" data-scroll-target="#other-model-families">Other Model Families</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Logistic Regression</h1>
<p class="subtitle lead">Mixed</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Sungkyun Cho </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">May 29, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<div id="5ef883ab" class="cell" data-execution_count="1">
<details class="code-fold">
<summary>Load packages</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># numerical calculation &amp; data frames</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co"># visualization</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn.objects <span class="im">as</span> so</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co"># statistics</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="co"># pandas options</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>pd.set_option(<span class="st">'mode.copy_on_write'</span>, <span class="va">True</span>)  <span class="co"># pandas 2.0</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>pd.options.display.float_format <span class="op">=</span> <span class="st">'</span><span class="sc">{:.2f}</span><span class="st">'</span>.<span class="bu">format</span>  <span class="co"># pd.reset_option('display.float_format')</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>pd.options.display.max_rows <span class="op">=</span> <span class="dv">7</span>  <span class="co"># max number of rows to display</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="co"># NumPy options</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>np.set_printoptions(precision <span class="op">=</span> <span class="dv">2</span>, suppress<span class="op">=</span><span class="va">True</span>)  <span class="co"># suppress scientific notation</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="co"># For high resolution display</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib_inline</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>matplotlib_inline.backend_inline.set_matplotlib_formats(<span class="st">"retina"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="generalized-linear-models" class="level1">
<h1>Generalized Linear Models</h1>
<p><strong>Ordinary least squares (OLS)</strong></p>
<ul>
<li>Mean function: <span class="math inline">\(E(Y | X = x_i) = \beta_0 + \beta_1 x_i\)</span></li>
<li>Distribution: <span class="math inline">\((Y | X = x_i) \sim N(\beta_0 + \beta_1 x_i, \sigma^2)\)</span></li>
</ul>
<p><img src="images/ols.png" class="img-fluid" width="500"></p>
<div style="line-height: 1.5em; font-size: .9em">
<p>Source: p.107, <em>Applied Regression Analysis and Generalized Linear Models (3e), by John Fox</em></p>
</div>
<p><strong>Generalized linear models (GLM)</strong></p>
<p>OLS의 가정에 맞지 않는 경우, 가정을 완화한 모델</p>
<ul>
<li>Mean function: <span class="math inline">\(E(Y | X = x_i) = f(\beta_0 + \beta_1 x_i)\)</span></li>
<li>Distribution: <span class="math inline">\((Y | X = x_i) \sim \text{Exponential family}\)</span></li>
</ul>
<p><em>Binary outcome: Logistic regression</em></p>
<ul>
<li>Mean function: <span class="math inline">\(\displaystyle E(Y | X = x_i) = f(\beta_0 + \beta_1 x_i)\)</span>, &nbsp; <span class="math inline">\(\displaystyle f = \frac{1}{1 + e^{-x}}\)</span> : <em>sigmoid function</em></li>
<li>Distribution: <span class="math inline">\((Y | X = x_i) \sim \text{Bernoulli}(p_i)\)</span>: <em>n=1</em>인 이항분포</li>
</ul>
<p><em>Count outcome: Poisson regression</em></p>
<ul>
<li>Mean function: <span class="math inline">\(\displaystyle E(Y | X = x_i) = f(\beta_0 + \beta_1 x_i)\)</span>, &nbsp; <span class="math inline">\(\displaystyle f = e^x\)</span></li>
<li>Distribution: <span class="math inline">\((Y | X = x_i) \sim \text{Poisson}(\lambda_i)\)</span></li>
</ul>
<p>전형적으로 나타나는 <span class="math inline">\(X\)</span>와 <span class="math inline">\(Y\)</span>의 관계</p>
<p><img src="images/glm-plot.png" class="img-fluid" width="700"></p>
</section>
<section id="logistic-regression" class="level1">
<h1>Logistic Regression</h1>
<p>Response 변수가 binary로 두 개의 클래스에 속하는 경우; <span class="math inline">\(Y \in \{C_1, C_2\}\)</span><br>
보통 관심이 있는 쪽을 1로, 나머지를 0으로 코딩하여 전개</p>
<p>예제: Blowdown<br>
<em>p.274, Applied Linear Regression (4e) by Sanford Weisberg</em></p>
<p>Data: <a href="https://www.dropbox.com/scl/fi/q4fft4jbxeesg2d57qy1f/blowdown2.csv?rlkey=guzocyk8mkolbz7ay06bbfou1&amp;dl=1">blowdown2.csv</a></p>
<blockquote class="blockquote">
<p>1999년 7월 4일, 미네소타 북동부의 바운더리 워터스 카누 지역 야생지대에 시속 90마일이 넘는 폭풍이 몰아쳐 숲에 심각한 피해를 입혔습니다. Rich 등(2007)은 이 지역에 대한 매우 광범위한 지상 조사를 통해 이 폭풍의 영향을 연구하여 3600여 그루의 나무의 생사 여부를 확인했습니다.</p>
</blockquote>
<p><code>d</code>: 나무의 지름(cm),  <code>y</code>: 나무가 죽은 경우 1, 그렇지 않으면 0<br>
<code>spp</code>: 나무의 종,  <code>s</code>: 특정 지역의 폭풍의 심각도</p>
<div id="6d92b5e8" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>blowdown <span class="op">=</span> pd.read_csv(<span class="st">'data/blowdown2.csv'</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co"># black spruce에 제한</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>blowbs <span class="op">=</span> blowdown.query(<span class="st">'spp == "black spruce"'</span>)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>blowbs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">
<pre><code>         d    s  y           spp  log2d
17    9.00 0.02  0  black spruce   3.17
24   11.00 0.03  0  black spruce   3.46
25    9.00 0.03  0  black spruce   3.17
...    ...  ... ..           ...    ...
3646  9.00 0.94  1  black spruce   3.17
3647 17.00 0.94  1  black spruce   4.09
3661  8.00 0.98  1  black spruce   3.00

[659 rows x 5 columns]</code></pre>
</div>
</div>
<p>기존의 ordinary least squares (OLS) 방법으로 fit을 하면, (linear probability model)</p>
<ul>
<li>Y; 1: event, 0: non-event</li>
<li>Mean funtion <span class="math inline">\(E(Y | X = x_i)\)</span>을 생각하면 각 나무의 두께에 해당하는 쓰러진 나무의 비율, 즉 확률값으로 해석할 수 있음.</li>
</ul>
<details class="code-fold">
<summary>code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    so.Plot(blowbs, x<span class="op">=</span><span class="st">'log2d'</span>, y<span class="op">=</span><span class="st">'y'</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    .add(so.Dots(alpha<span class="op">=</span><span class="fl">.3</span>), so.Jitter(y<span class="op">=</span><span class="fl">.1</span>))</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    .add(so.Line(), so.PolyFit(<span class="dv">1</span>))</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    .limit(y<span class="op">=</span>(<span class="op">-</span><span class="fl">0.2</span>, <span class="fl">1.2</span>))</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    .scale(y<span class="op">=</span>so.Continuous().tick(at<span class="op">=</span>[<span class="dv">0</span>, <span class="dv">1</span>]))</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    .layout(size<span class="op">=</span>(<span class="dv">6</span>, <span class="fl">3.5</span>))</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    .label(x<span class="op">=</span><span class="st">'Log Diameter (cm)'</span>, y<span class="op">=</span><span class="st">'Died vs. Survived'</span>, title<span class="op">=</span><span class="st">"Linear Fit"</span>)</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>).show()</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>    nsplot(blowbs, x<span class="op">=</span><span class="st">'log2d'</span>, y<span class="op">=</span><span class="st">'y'</span>, alpha<span class="op">=</span><span class="dv">0</span>, df_n<span class="op">=</span><span class="dv">6</span>)</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>    .add(so.Dots(alpha<span class="op">=</span><span class="fl">.3</span>), so.Jitter(y<span class="op">=</span><span class="fl">.1</span>))</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>    .limit(y<span class="op">=</span>(<span class="op">-</span><span class="fl">0.2</span>, <span class="fl">1.2</span>))</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>    .scale(y<span class="op">=</span>so.Continuous().tick(at<span class="op">=</span>[<span class="dv">0</span>, <span class="dv">1</span>]))</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>    .layout(size<span class="op">=</span>(<span class="dv">6</span>, <span class="fl">3.5</span>))</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>    .label(x<span class="op">=</span><span class="st">'Log Diameter (cm)'</span>, y<span class="op">=</span><span class="st">'Died vs. Survived'</span>, title<span class="op">=</span><span class="st">"Nonlinear Fit"</span>)</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>).show()</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="9708bb61" class="cell quarto-layout-panel" data-execution_count="5" data-layout="[1, 1]">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="logistic_files/figure-html/cell-6-output-1.png" class="img-fluid" width="589"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="logistic_files/figure-html/cell-6-output-2.png" class="img-fluid" width="589"></p>
</div>
</div>
</div>
<p>Conditional distribution (근방에서)</p>
<details class="code-fold">
<summary>code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    blowbs.query(<span class="st">'d &lt; 15'</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    .assign(log2d <span class="op">=</span> blowbs[<span class="st">'log2d'</span>].<span class="bu">round</span>(<span class="dv">1</span>))</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    .pipe(so.Plot, x<span class="op">=</span><span class="st">'y'</span>)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    .add(so.Bar(), so.Hist(stat<span class="op">=</span><span class="st">"proportion"</span>, common_norm<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    .facet(<span class="st">"log2d"</span>, wrap<span class="op">=</span><span class="dv">5</span>)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    .layout(size<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">4</span>))</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    .label(title<span class="op">=</span><span class="st">'log d = </span><span class="sc">{}</span><span class="st">'</span>.<span class="bu">format</span>)</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="448e7ed0" class="cell quarto-layout-panel" data-execution_count="6" data-layout="[3, 1]">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 75.0%;justify-content: center;">
<p><img src="logistic_files/figure-html/cell-7-output-1.png" class="img-fluid" width="758"></p>
</div>
</div>
</div>
<section id="emperical-probability-odds" class="level2">
<h2 class="anchored" data-anchor-id="emperical-probability-odds">Emperical probability/ Odds</h2>
<p>이제 y를 직접 예측하기보다, 확률을 예측하는 방식을 취하면,</p>
<ul>
<li>각 두께를 가진 나무들의 개수 (<code>m</code>)와</li>
<li>그 중에 태풍으로 죽은 나무의 수 (<code>died</code>)를 고려하면,</li>
<li>나무의 두께에 따라 죽은 나무 수의 비율 (<code>p</code>= <code>died</code>/<code>m</code>)을 계산할 수 있음. 이를 emperical probability라고 함.</li>
<li>사실, 이 <code>p</code>는 binary response (0, 1)의 conditional mean(평균)인데,</li>
<li>통계적으로 표현하면 <span class="math inline">\(E(Y|d=d_i)\)</span>이며 선형모형의 mean function를 제공.</li>
</ul>
<div id="3b5055de" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>blowbs_bn <span class="op">=</span> blowbs.groupby(<span class="st">"d"</span>)[<span class="st">"y"</span>].agg([(<span class="st">"died"</span>, <span class="st">"sum"</span>), (<span class="st">"m"</span>, <span class="st">"count"</span>), (<span class="st">"p"</span>, <span class="st">"mean"</span>)]).reset_index()</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>blowbs_bn</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<pre><code>       d  died   m    p
0   5.00     7  90 0.08
1   6.00     7  92 0.08
2   7.00    18  91 0.20
..   ...   ...  ..  ...
22 28.00     2   2 1.00
23 29.00     1   2 0.50
24 32.00     1   1 1.00

[25 rows x 4 columns]</code></pre>
</div>
</div>
<details class="code-fold">
<summary>code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    so.Plot(blowbs_bn, x<span class="op">=</span><span class="st">'d'</span>, y<span class="op">=</span><span class="st">'p'</span>)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    .add(so.Dot(), pointsize<span class="op">=</span><span class="st">'m'</span>)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    .add(so.Dots(alpha<span class="op">=</span><span class="fl">.3</span>, color<span class="op">=</span><span class="st">".6"</span>), so.Jitter(y<span class="op">=</span><span class="fl">.1</span>), x<span class="op">=</span>blowbs.d, y<span class="op">=</span>blowbs.y)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># .add(so.Line(), so.PolyFit(5))</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    .add(so.Line(color<span class="op">=</span><span class="st">"#87bc45"</span>), so.PolyFit(<span class="dv">1</span>))</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    .limit(y<span class="op">=</span>(<span class="op">-</span><span class="fl">0.2</span>, <span class="fl">1.2</span>))</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    .layout(size<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">5</span>))</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    .label(title<span class="op">=</span><span class="st">'Emperical Probability'</span>, y <span class="op">=</span> <span class="st">'Proportion of Died'</span>, x<span class="op">=</span><span class="st">'Diameter (cm)'</span>)</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="d6fbd6f2" class="cell quarto-layout-panel" data-execution_count="8" data-layout="[3, 1]">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 75.0%;justify-content: center;">
<p><img src="logistic_files/figure-html/cell-9-output-1.png" class="img-fluid" width="834"></p>
</div>
</div>
</div>
<ul>
<li>OLS estimate으로도 충분한가?</li>
<li>1차보다는 고차 다항함수로 fit한다면?</li>
</ul>
<p>우선 d를 log2 변환해서 살펴보면,</p>
<details class="code-fold">
<summary>code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>blowbs_bn[<span class="st">"log2d"</span>] <span class="op">=</span> np.log2(blowbs_bn[<span class="st">"d"</span>])</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    so.Plot(blowbs_bn, x<span class="op">=</span><span class="st">'log2d'</span>, y<span class="op">=</span><span class="st">'p'</span>)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    .add(so.Dot(), pointsize<span class="op">=</span><span class="st">'m'</span>)</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    .add(so.Dots(alpha<span class="op">=</span><span class="fl">.3</span>, color<span class="op">=</span><span class="st">".6"</span>), so.Jitter(y<span class="op">=</span><span class="fl">.1</span>), x<span class="op">=</span>blowbs.log2d, y<span class="op">=</span>blowbs.y)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    .add(so.Line(color<span class="op">=</span><span class="st">"#87bc45"</span>), so.PolyFit(<span class="dv">1</span>))</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    .limit(y<span class="op">=</span>(<span class="op">-</span><span class="fl">0.2</span>, <span class="fl">1.2</span>))</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    .layout(size<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">5</span>))</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    .label(title<span class="op">=</span><span class="st">'Emperical Probability'</span>, y <span class="op">=</span> <span class="st">'Proportion of Died'</span>, x<span class="op">=</span><span class="st">'Log of Diameter (cm)'</span>)</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="6dad2803" class="cell quarto-layout-panel" data-execution_count="9" data-layout="[3, 1]">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 75.0%;justify-content: center;">
<p><img src="logistic_files/figure-html/cell-10-output-1.png" class="img-fluid" width="834"></p>
</div>
</div>
</div>
<p>위에서 살펴본 OLS의 문제들 즉,</p>
<ul>
<li>잔차에 패턴이 보인다는 것은 충분히 좋은 모형이 아니라는 것을 의미하고,</li>
<li>예측값이 확률을 의미하지 못할 수 있음.</li>
<li>잔차의 분포도 Gaussian과는 거리가 멈.</li>
</ul>
<p>이런 문제들을 해결하고 예측값이 분명한 “확률”의 의미를 품도록 여러 방식이 제시되는데 주로 사용되는 것이 logistic regression임.</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p><em>Binary outcome을 예측하는 logistic regression 모형은 binary 값을 예측하는 것이 아니고, 확률 값을 예측하는 것임.</em><br>
이후에 이를 이용해 binary outcome을 예측.</p>
<ul>
<li>예를 들어, 두께가 5cm인 (특정 종의) 나무가 태풍에 쓰러질 확률(true probability)을 파악하고자 함.</li>
<li>이 때, 관측값은 5cm인 나무 중 쓰러진 나무의 “비율”이고, 이 관측치들로부터 true probability를 추정하고자 함.</li>
</ul>
<p><strong>Odds</strong>의 정의: 실패할 확률 대비 성공할 확률의 비율</p>
<p><span class="math inline">\(\displaystyle odds = \frac{P(Y = 1)}{P(Y = 0)} = \frac{p}{1-p}\)</span></p>
<p>예를 들어, 5cm 두께의 나무는 90그루 중 7그루가 죽었으므로 83그루는 살았음.<br>
즉, 죽음:생존 = 7:83 <span class="math inline">\(\approx\)</span> 1:12 이고 odds = 7/83 = 0.084; 생존할 가능성 대비 죽을 가능성이 8.4%임.<br>
확률로 표현하면, <span class="math inline">\(odds = \frac{\frac{7}{90}}{1 - \frac{7}{90}} = \frac{7}{90-7} = \frac{7}{83}\)</span></p>
<p>확률과 odds, logit(log odds)의 관계</p>
<p><img src="images/odds.png" class="img-fluid" width="350"></p>
</div>
</div>
<div id="612f4d4b" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>blowbs_bn <span class="op">=</span> blowbs_bn.assign(odds <span class="op">=</span> <span class="kw">lambda</span> x: x.p <span class="op">/</span> (<span class="dv">1</span> <span class="op">-</span> x.p))</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="co"># p = 1인 경우 odds가 무한대가 되므로 편의상 inf 값을 50으로 대체</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>blowbs_bn[<span class="st">"odds"</span>] <span class="op">=</span> blowbs_bn[<span class="st">"odds"</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="dv">50</span> <span class="cf">if</span> x <span class="op">==</span> np.inf <span class="cf">else</span> x)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>blowbs_bn</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<pre><code>       d  died   m    p  log2d  odds
0   5.00     7  90 0.08   2.32  0.08
1   6.00     7  92 0.08   2.58  0.08
2   7.00    18  91 0.20   2.81  0.25
..   ...   ...  ..  ...    ...   ...
22 28.00     2   2 1.00   4.81 50.00
23 29.00     1   2 0.50   4.86  1.00
24 32.00     1   1 1.00   5.00 50.00

[25 rows x 6 columns]</code></pre>
</div>
</div>
<p>이 odds를 선형모형으로 나무두께로 예측하려고 하는 것인데, 예를 들어,</p>
<p><span class="math inline">\(\widehat{odds} = b_0 + b_1 \cdot \log_{2} d\)</span></p>
<p>odds 값의 범위는 (0, <span class="math inline">\(\infty\)</span>)이므로, 선형모형으로 fit하는 것이 적절하지 않음.<br>
한편, odds를 log 변환하면, 그 범위는 (<span class="math inline">\(-\infty\)</span>, <span class="math inline">\(\infty\)</span>)가 되어 선형모형으로 fit하는 것이 적절해짐.(또한, 가우시안 분포를 가정했을 때 최적임)</p>
<p>이 때, 예측모형은 log odds가 <span class="math inline">\(x\)</span>에 대해 선형적으로 연결된다고 가정하는 것임. 즉,</p>
<p><span class="math inline">\(\displaystyle \log \widehat{odds} = \log\left(\frac{\hat{p}}{1-\hat{p}}\right) = b_0 + b_1 \cdot \log_{2} d\)</span></p>
<p>이를 logit 함수로 간단히 표현하면; 전통적 통계에서 선호<br>
<span class="math inline">\(\displaystyle logit(\hat p) = b_0 + b_1 \cdot \log_{2} d\)</span>, &nbsp; <span class="math inline">\(\displaystyle logit(x) := \log\left(\frac{x}{1-x}\right)\)</span></p>
<p>logit의 역함수인 sigmoid 함수로 표현하면; machine learning에서 선호<br>
<span class="math inline">\(\displaystyle \hat p = \sigma(b_0 + b_1 \cdot \log_{2} d)\)</span>, &nbsp; <span class="math inline">\(\displaystyle \sigma(x) := \frac{1}{1 + e^{-x}}\)</span></p>
<p>이를 확률로 표현하면,<br>
<span class="math inline">\(\displaystyle P(Y=1|X=x) = E(Y|X=x) = \sigma(b_0 + b_1 \cdot \log_{2} d)\)</span></p>
<p>즉, logit은 예측변수 <span class="math inline">\(x\)</span> 와 선형적으로 연결되는데 반해, 확률 <span class="math inline">\(p\)</span> 는 예측변수 <span class="math inline">\(x\)</span> 와 비선형적 관계를 맺음</p>
<div>

</div>
<div id="fa280612" class="cell quarto-layout-panel" data-execution_count="15" data-layout="[1, 1]">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="logistic_files/figure-html/cell-12-output-1.png" class="img-fluid" width="470"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="logistic_files/figure-html/cell-12-output-2.png" class="img-fluid" width="478"></p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Mean function <span class="math inline">\(E(Y|X)\)</span>을 변형하는 방식으로 표현할 때,</p>
<p><span class="math inline">\(f(E(Y|X))=\beta_0 + \beta_1 X_1 + \cdots + \beta_n X_n\)</span></p>
<ul>
<li>이 때, <span class="math inline">\(f\)</span>를 link function이라고 하고,</li>
<li>여기서는 logit 함수를 link function으로 사용함.</li>
</ul>
<p>Machine learning에서는, 그 역함수를 이용해 선형함수 쪽을 변형해 다음과 같이 표현하는데,</p>
<p><span class="math inline">\(E(Y|X)=f(\beta_0 + \beta_1 X_1 + \cdots + \beta_n X_n)\)</span></p>
<ul>
<li>이 때, <span class="math inline">\(f\)</span>를 activation function이라고 부름.<br>
</li>
<li>여기서는 sigmoid 함수를 activation function으로 사용함.</li>
</ul>
<p>sigmoid 함수는 logisitic 함수라고도 부름.</p>
</div>
</div>
<p>한편, 각 클래스 내에서 <span class="math inline">\(X\)</span>가 multivariate Gaussian 분포를 따르고, 클래스 간에 covariance matrix가 동일하다고 가정하면,<br>
log odds가 <span class="math inline">\(X\)</span>에 대해 선형적으로 연결된다는 것을 보일 수 있음.</p>
<ul>
<li>여기서는 쓰러진 나무와 산 나무의 두께가 Gaussian 분포를 따르고,</li>
<li>그 두 분포의 분산이 동일하다면, log odds가 <span class="math inline">\(X\)</span>에 대해 선형적 연결될 수 있음.</li>
<li>나무의 두께(d)를 log2 변환한 이유임 (오른쪽 그림)</li>
</ul>
<details class="code-fold">
<summary>code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>blowbs[<span class="st">"label"</span>] <span class="op">=</span> blowbs[<span class="st">"y"</span>].<span class="bu">map</span>({<span class="dv">0</span>: <span class="st">"alive"</span>, <span class="dv">1</span>: <span class="st">"died"</span>})</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    so.Plot(blowbs, x<span class="op">=</span><span class="st">'d'</span>, color<span class="op">=</span><span class="st">'label'</span>)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    .add(so.Area(), so.KDE(common_norm<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">#.scale(color=so.Nominal())</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    .scale(color<span class="op">=</span>[<span class="st">'#70e20c'</span>, <span class="st">'#7d2be2'</span>])</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    .layout(size<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">5</span>))</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    .label(x<span class="op">=</span><span class="st">"Diameter (cm)"</span>, y<span class="op">=</span><span class="st">"Density"</span>, color<span class="op">=</span><span class="st">"Label"</span>)</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>).show()</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    so.Plot(blowbs, x<span class="op">=</span><span class="st">'log2d'</span>, color<span class="op">=</span><span class="st">'label'</span>)</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    .add(so.Area(), so.KDE(common_norm<span class="op">=</span><span class="va">False</span>))</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    .scale(color<span class="op">=</span>[<span class="st">'#70e20c'</span>, <span class="st">'#7d2be2'</span>])</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    .layout(size<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">5</span>))</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    .label(x<span class="op">=</span><span class="st">"Log of Diameter (cm)"</span>, y<span class="op">=</span><span class="st">"Density"</span>, color<span class="op">=</span><span class="st">"Label"</span>)</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>).show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="7fef49b7" class="cell quarto-layout-panel" data-execution_count="17" data-layout="[1, 1]">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="logistic_files/figure-html/cell-14-output-1.png" class="img-fluid" width="790"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="logistic_files/figure-html/cell-14-output-2.png" class="img-fluid" width="790"></p>
</div>
</div>
</div>
<p>이제, log odds을 구해, <span class="math inline">\(X\)</span>에 대해 선형적인 패턴이 있는지 확인해보면,</p>
<div id="5afe94e6" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>blowbs_bn <span class="op">=</span> blowbs_bn.assign(log_odds <span class="op">=</span> <span class="kw">lambda</span> x: np.log(x.odds))</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>blowbs_bn   </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="18">
<pre><code>       d  died   m    p  log2d  odds  log_odds
0   5.00     7  90 0.08   2.32  0.08     -2.47
1   6.00     7  92 0.08   2.58  0.08     -2.50
2   7.00    18  91 0.20   2.81  0.25     -1.40
..   ...   ...  ..  ...    ...   ...       ...
22 28.00     2   2 1.00   4.81 50.00      3.91
23 29.00     1   2 0.50   4.86  1.00      0.00
24 32.00     1   1 1.00   5.00 50.00      3.91

[25 rows x 7 columns]</code></pre>
</div>
</div>
<p>관측값들과 <strong>emperical probability</strong>와 <strong>log odds</strong>을 함께 살펴보면,</p>
<details class="code-fold">
<summary>code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>sns.scatterplot(x<span class="op">=</span>blowbs_bn.log2d, y<span class="op">=</span>blowbs_bn.p, size<span class="op">=</span>blowbs_bn.m, c<span class="op">=</span><span class="st">"#008fd5"</span>, sizes<span class="op">=</span>(<span class="dv">20</span>, <span class="dv">200</span>), ax<span class="op">=</span>ax)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> jitter(values, j):</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> values <span class="op">+</span> np.random.normal(<span class="dv">0</span>, j, values.shape)</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>sns.scatterplot(x<span class="op">=</span>blowbs.log2d, y<span class="op">=</span>jitter(blowbs.y, <span class="fl">0.02</span>), alpha<span class="op">=</span><span class="fl">.3</span>, c<span class="op">=</span><span class="st">".6"</span>, ax<span class="op">=</span>ax)</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, row <span class="kw">in</span> blowbs_bn.iterrows():</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    ax.annotate(<span class="ss">f"</span><span class="sc">{</span>row<span class="sc">.</span>died<span class="sc">:n}</span><span class="ss">/</span><span class="sc">{</span>row<span class="sc">.</span>m<span class="sc">:n}</span><span class="ss">"</span>, xy<span class="op">=</span>(row.log2d, row.p), xytext<span class="op">=</span>(row.log2d, row.p<span class="op">-</span><span class="fl">0.05</span>), size<span class="op">=</span><span class="dv">9</span>)</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>ax.set_xticks(blowbs_bn.log2d.unique())</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>ax.set_xticklabels(blowbs_bn.log2d.unique().<span class="bu">round</span>(<span class="dv">2</span>))</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>ax.tick_params(axis<span class="op">=</span><span class="st">'x'</span>, rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">"Emperical Probability"</span>)</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>ax.legend_.remove()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="8d91902a" class="cell quarto-layout-panel" data-execution_count="19" data-layout="[4, 1]">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 80.0%;justify-content: center;">
<p><img src="logistic_files/figure-html/cell-16-output-1.png" class="img-fluid" width="846"></p>
</div>
</div>
</div>
<p>Logit 값(분홍색)을 추가해서 그리면,</p>
<details class="code-fold">
<summary>code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>sns.scatterplot(x<span class="op">=</span>blowbs_bn.log2d, y<span class="op">=</span>blowbs_bn.p, size<span class="op">=</span>blowbs_bn.m, sizes<span class="op">=</span>(<span class="dv">20</span>, <span class="dv">200</span>), c<span class="op">=</span><span class="st">"#008fd5"</span>, ax<span class="op">=</span>ax, legend<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>sns.scatterplot(x<span class="op">=</span>blowbs_bn.log2d, y<span class="op">=</span>blowbs_bn.log_odds, size<span class="op">=</span>blowbs_bn.m, sizes<span class="op">=</span>(<span class="dv">20</span>, <span class="dv">200</span>), color<span class="op">=</span><span class="st">"#f46a9b"</span>, ax<span class="op">=</span>ax)</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> jitter(values, j):</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> values <span class="op">+</span> np.random.normal(<span class="dv">0</span>, j, values.shape)</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>sns.scatterplot(x<span class="op">=</span>blowbs.log2d, y<span class="op">=</span>jitter(blowbs.y, <span class="fl">0.02</span>), alpha<span class="op">=</span><span class="fl">.3</span>, c<span class="op">=</span><span class="st">".6"</span>, ax<span class="op">=</span>ax)</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, row <span class="kw">in</span> blowbs_bn.iterrows():</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>    ax.annotate(<span class="ss">f"logit</span><span class="sc">{</span>row<span class="sc">.</span>died<span class="sc">:n}</span><span class="ss">/</span><span class="sc">{</span>row<span class="sc">.</span>m<span class="sc">:n}</span><span class="ss">"</span>, xy<span class="op">=</span>(row.log2d, row.log_odds), xytext<span class="op">=</span>(row.log2d, row.log_odds<span class="op">-</span><span class="fl">0.4</span>), size<span class="op">=</span><span class="dv">9</span>)</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>ax.set_xticks(blowbs_bn.log2d.unique())</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>ax.set_xticklabels(blowbs_bn.log2d.unique().<span class="bu">round</span>(<span class="dv">2</span>))</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>ax.tick_params(axis<span class="op">=</span><span class="st">'x'</span>, rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">"P &amp; Logit"</span>)</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">"Emperical Probability and Logit"</span>)</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>ax.legend_.remove()</span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a><span class="co"># # polyfit 5</span></span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a><span class="co"># x = np.linspace(blowbs_bn.log2d.min(), blowbs_bn.log2d.max(), 100)</span></span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a><span class="co"># y = np.polyval(np.polyfit(blowbs_bn.log2d, blowbs_bn.log_odds, 5), x)</span></span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a><span class="co"># sns.lineplot(x=x, y=y, ax=ax, color=".6")</span></span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a><span class="co"># # polyfit 1</span></span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a><span class="co"># y = np.polyval(np.polyfit(blowbs_bn.log2d, blowbs_bn.log_odds, 1), x)</span></span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a><span class="co"># sns.lineplot(x=x, y=y, ax=ax, color=".6")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="a4f966e4" class="cell quarto-layout-panel" data-execution_count="20" data-layout="[4, 1]">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 80.0%;justify-content: center;">
<p><img src="logistic_files/figure-html/cell-17-output-1.png" class="img-fluid" width="856"></p>
</div>
</div>
</div>
<p>위의 logit값을 선형모형으로 예측하는 모형: <span class="math inline">\(\displaystyle \log\left(\frac{\hat{p}}{1-\hat{p}}\right) = b_0 + b_1 \cdot \log_{2} d\)</span></p>
<p>파라미터 <span class="math inline">\(b_0, b_1\)</span>의 추정은 잔차들의 제곱의 합을 최소로 하는 OLS 방식은 부적절하며, 대신에 Maximum Likelihood Estimation을 사용함.</p>
<ul>
<li>아이디어는 관측치가 전체적으로 관찰될 likelihood가 최대가 되도록 <span class="math inline">\(b_0, b_1\)</span>을 선택하는 것임</li>
<li>이를 위해서 적절한 확률모형을 결합시켜야 함.</li>
<li>선택하는 확률 모형은 Bernoulli 분포임; 평균 <span class="math inline">\(E(Y|X) = p\)</span>이고, <span class="math inline">\(logit(E(Y|X)) = b_0 + b_1 \cdot \log_{2} d\)</span>
<ul>
<li>발생 비율값으로 변환해 Binomial distribution (이항분포)로 전개하는 방식도 있음; binomial logit model</li>
</ul></li>
<li><strong>관찰값은 Bernoulli 분포로부터 발생했다고 가정</strong>함으로써, 실제 관찰값들이 관찰될 확률/가능도를 기준으로 파라미터를 추정할 수 있음.</li>
</ul>
<!-- 참고: 이항분포 (Y: 사건의 횟수) -->
<!-- ![](images/binomial.png){width=750} -->
<div>

</div>
<div id="2d803e77" class="cell quarto-layout-panel" data-execution_count="21" data-layout="[10, -1, 10, -1]">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 45.5%;justify-content: center;">
<p><img src="logistic_files/figure-html/cell-18-output-1.png" class="img-fluid" width="545"></p>
</div>
<div class="quarto-figure-spacer quarto-layout-cell" style="flex-basis: 4.6%;justify-content: flex-start;">
<p>&nbsp;</p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 45.5%;justify-content: center;">
<p><img src="logistic_files/figure-html/cell-18-output-2.png" class="img-fluid" width="545"></p>
</div>
<div class="quarto-figure-spacer quarto-layout-cell" style="flex-basis: 4.6%;justify-content: flex-start;">
<p>&nbsp;</p>
</div>
</div>
</div>
<div id="417761cc" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>blowbs.sort_values(<span class="st">"log2d"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="22">
<pre><code>         d    s  y           spp  log2d  label
2102  5.00 0.45  0  black spruce   2.32  alive
724   5.00 0.18  0  black spruce   2.32  alive
723   5.00 0.18  1  black spruce   2.32   died
...    ...  ... ..           ...    ...    ...
1784 29.00 0.38  1  black spruce   4.86   died
1079 29.00 0.25  0  black spruce   4.86  alive
3455 32.00 0.80  1  black spruce   5.00   died

[659 rows x 6 columns]</code></pre>
</div>
</div>
<p><img src="images/blowdown.png" class="img-fluid" width="650"></p>
<p>각 likelihood는 관측치들이 모두 <strong>독립</strong>적으로 발생했다고 가정했을 때의 확률값이고,<br>
각 <span class="math inline">\(x_i\)</span>(그에 대응하는 <span class="math inline">\(p_i\)</span>)에 대해 관측치(<span class="math inline">\(y_i\)</span>)가 관찰된 확률은 간결하게 다음과 같이 표현할 수 있음.</p>
<p><span class="math display">\[p_i^{y_i} (1-p_i)^{1-y_i}\]</span></p>
<p><span class="math display">\[\displaystyle \text{log likelihood}=\log \prod_{i=1}^{n}{P_i}=\sum_{i=1}^{n} y_i \cdot \log p_i + (1-y_i) \cdot \log(1-p_i)\]</span></p>
<p>모든 데이터가 관찰될 likelihood = <span class="math inline">\(p_1^7 (1-p_1)^{83} \cdot p_2^7 (1-p_2)^{85} \cdot p_3^{18} \cdot (1-p_3)^{73} \cdots\)</span></p>
<p>이 때, 모형을 예측변수 <span class="math inline">\(X\)</span>의 1차 다항함수로 fit한다면, &nbsp; <span class="math inline">\(\displaystyle \log\left(\frac{p_i}{1-p_i}\right) = \beta_0 + \beta_1 \cdot x_i\)</span> 인데,<br>
변형하면 &nbsp; <span class="math inline">\(\displaystyle p_i = \sigma(\beta_0 + \beta_1 x_i) = \frac{1}{1+e^{-(\beta_0 + \beta_1 \cdot x_i)}}\)</span></p>
<p>Likelihood = <span class="math inline">\(\displaystyle \left(\frac{1}{1+e^{-(\beta_0 + \beta_1 \cdot 2.32)}}\right)^7 \left(1 - \frac{1}{1+e^{-(\beta_0 + \beta_1 \cdot 2.32)}}\right)^{83} \cdot \left(\frac{1}{1+e^{-(\beta_0 + \beta_1 \cdot 2.58)}}\right)^7 \left(1 - \frac{1}{1+e^{-(\beta_0 + \beta_1 \cdot 2.58)}}\right)^{85} \cdots\)</span></p>
<p>이 Likelihood가 최대가 되도록 <span class="math inline">\(\beta_0, \beta_1\)</span>의 추정치를 찾음.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>위의 Log likelihood = <span class="math inline">\(\displaystyle \sum_{i=1}^{n} y_i \cdot \log p_i + (1-y_i) \cdot \log(1-p_i)\)</span>는</p>
<p>머신러닝에서 손실함수로 사용되는 cross-entropy loss와 (거의) 동일함.</p>
<p><span class="math inline">\(L = -\frac{1}{n} \sum_{i=1}^{n} y_i \cdot \log p_i + (1-y_i) \cdot \log (1-p_i)\)</span></p>
<p>첫 번째 항: <span class="math inline">\(\displaystyle \sum -y_i \cdot \log p_i = \sum y_i \cdot \log \frac{1}{p_i} = \sum y_i \cdot \log \frac{y_i}{p_i}= \sum \left(y_i \cdot \log y_i - y_i \cdot \log p_i\right)\)</span><br>
= cross-entropy - entropy (부정확하게 예측되어 발생하는 정보 손실량: Kullback-Leibler divergence)</p>
</div>
</div>
<div class="callout callout-style-default callout-important callout-titled" title="Regularization">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Regularization
</div>
</div>
<div class="callout-body-container callout-body">
<p>앞서 Ridge, Lasso에서와 비슷한 원리로 OLS가 아닌 ML(maximum likelihood) estimator에 penalty를 적용하는 방식임.<br>
즉, likeihood에 대한 계산에서 penalty term을 추가함</p>
<p>에를 들어, Logistic regression with L2 regularization: 다음 손실함수를 최소화하도록 파라미터를 추정</p>
<p><span class="math inline">\(\displaystyle L = \frac{1}{n} \left[ - \sum_{i=1}^{n} \left(y_i \cdot \log p_i + (1-y_i) \cdot \log(1-p_i)\right) + \frac{\lambda}{2} \sum_{j=1}^{p} \beta_j^2 \right]\)</span></p>
</div>
</div>
<div id="65a795b7" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.formula.api <span class="im">as</span> smf</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>mod <span class="op">=</span> smf.logit(<span class="st">'y ~ log2d'</span>, data<span class="op">=</span>blowbs).fit()</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(mod.summary())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Optimization terminated successfully.
         Current function value: 0.499165
         Iterations 6
                           Logit Regression Results                           
==============================================================================
Dep. Variable:                      y   No. Observations:                  659
Model:                          Logit   Df Residuals:                      657
Method:                           MLE   Df Model:                            1
Date:                Tue, 27 May 2025   Pseudo R-squ.:                  0.2316
Time:                        23:59:25   Log-Likelihood:                -328.95
converged:                       True   LL-Null:                       -428.10
Covariance Type:            nonrobust   LLR p-value:                 4.888e-45
==============================================================================
                 coef    std err          z      P&gt;|z|      [0.025      0.975]
------------------------------------------------------------------------------
Intercept     -7.8162      0.628    -12.437      0.000      -9.048      -6.584
log2d          2.2408      0.190     11.773      0.000       1.868       2.614
==============================================================================</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled" title="Scikit-learn implementation">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Scikit-learn implementation
</div>
</div>
<div class="callout-body-container callout-body">
<p>Scikit-learn의 <code>LogisticRegression()</code>은 디폴트로 <span class="math inline">\(l2\)</span> regularization을 사용함: <a href="https://scikit-learn.org/stable/modules/linear_model.html#logistic-regression">참고 문서</a></p>
<p>우선, train-test split을 통해 데이터를 나눈 후, <code>LogisticRegression()</code>을 적용하면,</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LogisticRegression</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> blowbs[[<span class="st">'log2d'</span>]]</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> blowbs[<span class="st">'y'</span>]</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(X, y, test_size<span class="op">=</span><span class="fl">0.5</span>, random_state<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>lr <span class="op">=</span> LogisticRegression(penalty<span class="op">=</span><span class="va">None</span>)  <span class="co"># l1, l2 regularization 가능</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>lr.fit(X_train, y_train)</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(lr.coef_, lr.intercept_)</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a><span class="co"># [[2.08]] [-7.26]</span></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a><span class="co"># As a DataFrame with column names</span></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>coefs <span class="op">=</span> pd.DataFrame({<span class="st">"coef"</span>: lr.coef_[<span class="dv">0</span>], <span class="st">"name"</span>: X.columns})</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>coefs</span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a><span class="co">#    coef   name</span></span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a><span class="co"># 0  2.08  log2d</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>위 fitted model의 예측값들</p>
<details class="code-fold">
<summary>code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">9</span>, <span class="dv">5</span>))</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>sns.scatterplot(x<span class="op">=</span>blowbs_bn.log2d, y<span class="op">=</span>blowbs_bn.p, size<span class="op">=</span>blowbs_bn.m, c<span class="op">=</span><span class="st">"#008fd5"</span>, sizes<span class="op">=</span>(<span class="dv">20</span>, <span class="dv">200</span>), ax<span class="op">=</span>ax)</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> jitter(values, j):</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> values <span class="op">+</span> np.random.normal(<span class="dv">0</span>, j, values.shape)</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>sns.scatterplot(x<span class="op">=</span>blowbs.log2d, y<span class="op">=</span>jitter(blowbs.y, <span class="fl">0.02</span>), alpha<span class="op">=</span><span class="fl">.3</span>, c<span class="op">=</span><span class="st">".6"</span>, ax<span class="op">=</span>ax)</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, row <span class="kw">in</span> blowbs_bn.iterrows():</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    ax.annotate(<span class="ss">f"</span><span class="sc">{</span>row<span class="sc">.</span>died<span class="sc">:n}</span><span class="ss">/</span><span class="sc">{</span>row<span class="sc">.</span>m<span class="sc">:n}</span><span class="ss">"</span>, xy<span class="op">=</span>(row.log2d, row.p), xytext<span class="op">=</span>(row.log2d, row.p<span class="op">-</span><span class="fl">0.05</span>), size<span class="op">=</span><span class="dv">9</span>)</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>ax.set_xticks(blowbs_bn.log2d.unique())</span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>ax.set_xticklabels(blowbs_bn.log2d.unique().<span class="bu">round</span>(<span class="dv">2</span>))</span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a><span class="co"># x-axis with 45 degree rotation</span></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>ax.tick_params(axis<span class="op">=</span><span class="st">'x'</span>, rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a><span class="co"># fitted line</span></span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>sns.lineplot(x<span class="op">=</span>blowbs.log2d, y<span class="op">=</span>mod.predict(blowbs[<span class="st">"log2d"</span>]), ax<span class="op">=</span>ax, color<span class="op">=</span><span class="st">"#87bc45"</span>)</span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="a8234351" class="cell quarto-layout-panel" data-execution_count="25" data-layout="[4, 1]">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 80.0%;justify-content: center;">
<p><img src="logistic_files/figure-html/cell-22-output-1.png" class="img-fluid" width="768"></p>
</div>
</div>
</div>
</section>
<section id="prediction-values" class="level2">
<h2 class="anchored" data-anchor-id="prediction-values">Prediction Values</h2>
<p>예측값</p>
<p>Logistic regression에서는 세 가지 타입의 예측값들이 있음.</p>
<ul>
<li>Predicted probability: &nbsp; <span class="math inline">\(\displaystyle \hat{p} = \frac{1}{1+e^{-(b_0 + b_1 \cdot x)}}\)</span></li>
<li>Odds: &nbsp; <span class="math inline">\(\displaystyle odds = \frac{\hat{p}}{1 - \hat{p}} = e^{b_0 + b_1 \cdot x}\)</span>, &nbsp;Odds ratio: &nbsp; <span class="math inline">\(\displaystyle \frac{odds_1}{odds_2} = e^{b_1 \cdot (x_1 - x_2)}\)</span></li>
<li>Log odds: &nbsp; <span class="math inline">\(\displaystyle logit = b_0 + b_1 \cdot x\)</span></li>
</ul>
<p>이 확률값을 이용해 binary outcome인 클래스를 예측할 수 있음.</p>
<div id="e1010a35" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># using statsmodels package, not scikit-learn</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>blowbs_pred <span class="op">=</span> blowbs.assign(</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>    pred_prob <span class="op">=</span> mod.predict(blowbs[<span class="st">"log2d"</span>]),</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>    pred_odds <span class="op">=</span> <span class="kw">lambda</span> x: x.pred_prob <span class="op">/</span> (<span class="dv">1</span> <span class="op">-</span> x.pred_prob),</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>    pred_logit <span class="op">=</span> <span class="kw">lambda</span> x: mod.predict(blowbs[<span class="st">"log2d"</span>], which<span class="op">=</span><span class="st">"linear"</span>)</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>blowbs_pred.iloc[:, <span class="dv">1</span>:]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="20">
<pre><code>        s  y           spp  log2d  label  pred_prob  pred_odds  pred_logit
17   0.02  0  black spruce   3.17  alive       0.33       0.49       -0.71
24   0.03  0  black spruce   3.46  alive       0.48       0.94       -0.06
25   0.03  0  black spruce   3.17  alive       0.33       0.49       -0.71
...   ... ..           ...    ...    ...        ...        ...         ...
3646 0.94  1  black spruce   3.17   died       0.33       0.49       -0.71
3647 0.94  1  black spruce   4.09   died       0.79       3.83        1.34
3661 0.98  1  black spruce   3.00   died       0.25       0.33       -1.09

[659 rows x 8 columns]</code></pre>
</div>
</div>
<p>예를 들어, 두께(<code>log2d</code>)가 3인 나무의 경우,</p>
<ul>
<li>Probabiliy: 태풍에 쓰러질 확률은 25%로 예측되며,</li>
<li>Odds: 태풍에 쓰러지지 않을 가능성 대비 쓰러질 가능성의 비율은 1:0.33이므로 대략 3:1로 예측됨. 즉 다시 말하면, 1 그루가 쓰러진다면 3 그루는 쓰러지지 않을 것으로 예측함.
<ul>
<li>Odds가 1이면 event의 확률(p)이 0.5</li>
<li>Odds가 1보다 작으면 event의 확률(p)이 0.5보다 작고,</li>
<li>Odds가 1보다 크면 event의 확률(p)이 0.5보다 큼.</li>
</ul></li>
<li>Log odds (logit): 확률 p의 [0, 1]의 값을 무한한 값으로 늘려 linearly fit할 수 있게 함.</li>
</ul>
<div class="callout callout-style-default callout-note callout-titled" title="모형의 파라미터 해석">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-6-contents" aria-controls="callout-6" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
모형의 파라미터 해석
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-6" class="callout-6-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p><strong>Odds의 비율 (odds ratio, OR)</strong>을 통해 해석</p>
<ul>
<li><p><span class="math inline">\(\displaystyle odds: \frac{\hat{p}}{1 - \hat{p}} = e^{b_0 + b_1 \cdot x}=e^{b_0}\cdot e^{b_1 \cdot x}\)</span> &nbsp;로부터</p></li>
<li><p><span class="math inline">\(x\)</span>가 1 증가할 때 odds의 비율: <span class="math inline">\(\displaystyle odds ~ratio: \frac{\frac{\hat{p_2}}{1 - \hat{p_2}}}{\frac{\hat{p_1}}{1 - \hat{p_1}}}  = e^{b_1 \cdot (x+1) - b_1 \cdot x} = e^{b_1}\)</span></p></li>
<li><p>즉, <span class="math inline">\(x\)</span>가 1 증가하면, odds가 “몇 배”로 증가하는지를 나타냄.</p></li>
<li><p>따라서, odds ratio가 1보다 크면 (<span class="math inline">\(b_1\)</span>이 양수) <span class="math inline">\(x\)</span>가 1 증가할 때, event의 odds가 커지며,</p></li>
<li><p>odds ratio가 1보다 작으면 (<span class="math inline">\(b_1\)</span>이 음수) event의 odds가 줄어듬.</p></li>
</ul>
<p>위의 경우, <span class="math inline">\(\displaystyle \widehat{odds} = e^{-7.82 + 2.24 \cdot log_2(d)}\)</span> 이므로 odds ratio = <span class="math inline">\(e^{2.24} = 9.4\)</span></p>
<ul>
<li>해석하면, 나무의 두께가 (log2 scale로) 1 늘어남 (2배 증가)에 따라 태풍에 나무가 쓰러질 odds가 9.4배 증가함</li>
<li>다시 말하면, 나무의 두께가 (log2 scale로) 1 늘어남 (2배 증가)에 따라 태풍에 나무가 쓰러지지 않을 가능성 대비 쓰러질 가능성이 9.4배 증가함.</li>
<li>나무의 두께 (원래 d)로 말하면, 두께가 10% 두꺼워지면, <span class="math inline">\(e^{2.24 \cdot log_2(1.1)}=1.36\)</span> 배, 즉 odds가 36% 증가함.</li>
</ul>
<p><span class="math inline">\(b_0\)</span>: d = 1일 때의 odds이므로 <span class="math inline">\(\displaystyle e^{-7.82 + 2.34 \cdot 0} = e^{-7.82} = 0.004\)</span>, 즉 두께가 1cm 일 때 태풍에 나무가 쓰러지지 않을 가능성 대비 쓰러질 가능성은 0.004임.</p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled" title="Scikit-learn implementation">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-7-contents" aria-controls="callout-7" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Scikit-learn implementation
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-7" class="callout-7-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>Scikit-learn의 <code>LogisticRegression()</code>은 디폴트로 <span class="math inline">\(l2\)</span> regularization을 사용함: <a href="https://scikit-learn.org/stable/modules/linear_model.html#logistic-regression">참고 문서</a></p>
<div class="sourceCode" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LogisticRegression</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> blowbs[[<span class="st">'log2d'</span>]]</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> blowbs[<span class="st">'y'</span>]</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(X, y, test_size<span class="op">=</span><span class="fl">0.5</span>, random_state<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>lr <span class="op">=</span> LogisticRegression(penalty<span class="op">=</span><span class="va">None</span>)  <span class="co"># l1, l2 regularization 가능</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>lr.fit(X_train, y_train)</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a><span class="co"># predict_proba: 각 클래스에 대한 확률을 반환</span></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a><span class="co"># predict: 예측된 클래스를 반환 (threshold=0.5)</span></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>test_pred <span class="op">=</span> X_test.assign(</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span>y_test,</span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>    pred_prob<span class="op">=</span>lr.predict_proba(X_test)[:, <span class="dv">1</span>],  <span class="co"># 확률값</span></span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>    pred_class<span class="op">=</span>lr.predict(X_test),  <span class="co"># 클래스</span></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>    pred_odds<span class="op">=</span><span class="kw">lambda</span> x: x.pred_prob <span class="op">/</span> (<span class="dv">1</span> <span class="op">-</span> x.pred_prob),  <span class="co"># odds</span></span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>    pred_logit<span class="op">=</span><span class="kw">lambda</span> x: np.log(x.pred_odds),  <span class="co"># log odds</span></span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>test_pred.head(<span class="dv">5</span>)</span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a><span class="co">#       log2d  y  pred_prob  pred_class  pred_odds  pred_logit</span></span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a><span class="co"># 2890   3.46  1       0.48           0       0.94       -0.07</span></span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a><span class="co"># 574    3.81  0       0.66           1       1.93        0.66</span></span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a><span class="co"># 96     3.17  0       0.34           0       0.51       -0.67</span></span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a><span class="co"># 2773   3.46  1       0.48           0       0.94       -0.07</span></span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true" tabindex="-1"></a><span class="co"># 1813   3.58  1       0.55           1       1.21        0.19</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</section>
<section id="predictive-accuracy" class="level2">
<h2 class="anchored" data-anchor-id="predictive-accuracy">Predictive Accuracy</h2>
<p>모형의 예측 정확성</p>
<p>분류 문제의 경우, 보통 두 단계를 거쳐 예측</p>
<ul>
<li>Inference: 클래스에 속할 확률을 추정; 확률을 추정하지 않는 알고리즘도 있음.</li>
<li>Decision: 추정된 확률을 기반으로 클래스를 결정
<ul>
<li>기본적으로 0.5 이상이면 1로, 그렇지 않으면 0으로 분류</li>
<li>Threshold를 조정해 분류를 조정할 수 있음
<ul>
<li>예를 들어, 확실한 경우(<em>p &gt; 0.8</em>)에만 1로 분류</li>
</ul></li>
<li>애매한 확률 구간의 경우 결정을 유보할 수 있음; <em>reject option</em></li>
</ul></li>
</ul>
<p>이 때, 모형의 예측 정확성을 평가하는 두 가지 방식이 있음.</p>
<ul>
<li>확률 대한 예측 정확성 (evaluating predicted probability)</li>
<li>클래스에 대한 예측 정확성 (evaluating predicted class)</li>
</ul>
<section id="evaluation-of-predicted-probability" class="level3">
<h3 class="anchored" data-anchor-id="evaluation-of-predicted-probability">Evaluation of predicted probability</h3>
<div class="callout callout-style-default callout-note callout-titled" title="Deviance Residuals">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-8-contents" aria-controls="callout-8" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Deviance Residuals
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-8" class="callout-8-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>이제 이 모형이 좋은 모형인지 살펴보기 위해 residual, 잔차를 살펴볼 수 있는가?</p>
<p>Binomial version</p>
<ul>
<li>Pearson residual: <span class="math inline">\(\displaystyle \frac{actual ~ count ~ - predicted ~ count}{SD ~ of ~ count} = \frac{y_i - m_i \hat{p}_i}{\sqrt{m_i \hat{p}_i (1-\hat{p}_i)}}\)</span></li>
<li>Deviance residual: <span class="math inline">\(\displaystyle sign(y_i - m_i\hat{p}_i) \sqrt{-2[y_i log(\frac{y_i}{m_i\hat{p}_i}) + (m_i-y_i) log(\frac{m_i - y_i}{m_i-m_i\hat{p}_i})]}\)</span></li>
</ul>
<p>Binary version</p>
<ul>
<li>Pearson residual: <span class="math inline">\(\displaystyle \frac{y_i - \hat{p}_i}{\sqrt{\hat{p}_i (1-\hat{p}_i)}}\)</span></li>
<li>Deviance residual: <span class="math inline">\(\displaystyle sign(y_i - \hat{p}_i) \sqrt{-2[y_i log(\hat{p}_i) + (1-y_i) log(1-\hat{p}_i)]}=sign(y_i - \hat{p}_i)\sqrt{-2log(likelihood)}\)</span></li>
</ul>
<p>Deviance를 이용해 OLS에서의 <span class="math inline">\(R^2\)</span>와 비슷한 개념을 구성: <strong>Pseudo R-squared</strong></p>
<p>Model deviance, <span class="math inline">\(D_k = -2[log(likelihood_k) - log(likelihood_{perfect})]\)</span></p>
<ul>
<li>Perfect model의 likelihood: 1</li>
</ul>
<p>Deviance for an intercept only model; null_deviance = 856.2073760911842</p>
<ul>
<li>Pseudo R-squared: <span class="math inline">\(\displaystyle \frac{Null~Deviance - Deviance}{Null~Deviance}\)</span></li>
<li>Cox-Snell’s Pseudo R-squared</li>
<li>Nagelkerke’s Pseudo R-squared</li>
</ul>
<p>“Coefficient of discrimination” (Tjur, 2009): average <span class="math inline">\(\hat{p}\)</span> when <span class="math inline">\(y=1\)</span> - average <span class="math inline">\(\hat{p}\)</span> when <span class="math inline">\(y=0\)</span></p>
</div>
</div>
</div>
<p>클래스별 예측 확률의 분포/히스토그램</p>
<div id="2b191547" class="cell" data-execution_count="196">
<details class="code-fold">
<summary>code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>test_pred[<span class="st">"y2"</span>] <span class="op">=</span> test_pred[<span class="st">"y"</span>].<span class="bu">map</span>({<span class="dv">0</span>: <span class="st">"survived (y=0)"</span>, <span class="dv">1</span>: <span class="st">"died (y=1)"</span>})</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>    so.Plot(test_pred, x<span class="op">=</span><span class="st">'pred_prob'</span>)</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>    .add(so.Bars(color<span class="op">=</span><span class="st">"#ef9b20"</span>), so.Hist(bins<span class="op">=</span><span class="dv">12</span>))</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>    .facet(<span class="st">"y2"</span>)</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>    .label(x<span class="op">=</span><span class="st">"Predicted Probability"</span>, y<span class="op">=</span><span class="st">"Count"</span>)</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>    .layout(size<span class="op">=</span>(<span class="dv">7</span>, <span class="dv">4</span>))</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="196">
<div>
<figure class="figure">
<p><img src="logistic_files/figure-html/cell-28-output-1.png" width="662" height="374" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>각 (확률 값의) bin에 포함되는 관측치의 실제 값(<span class="math inline">\(y \in \{0, 1\}\)</span>)의 비율을 계산해 시각화</p>
<details class="code-fold">
<summary>code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.calibration <span class="im">import</span> calibration_curve</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. calibration_curve로 실제 비율 계산</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>prob_true, prob_pred <span class="op">=</span> calibration_curve(</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>    test_pred[<span class="st">"y"</span>], test_pred[<span class="st">"pred_prob"</span>], n_bins<span class="op">=</span><span class="dv">10</span>, strategy<span class="op">=</span><span class="st">"uniform"</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>    so.Plot(x<span class="op">=</span>prob_pred, y<span class="op">=</span>prob_true)</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>    .add(so.Line(marker<span class="op">=</span><span class="st">"o"</span>, color<span class="op">=</span><span class="st">"#f46a9b"</span>))</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>    .add(so.Line(color<span class="op">=</span><span class="st">".3"</span>, linestyle<span class="op">=</span><span class="st">":"</span>), y<span class="op">=</span>prob_pred)</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>    .scale(x<span class="op">=</span>so.Continuous().tick(at<span class="op">=</span>np.linspace(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">11</span>)))</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>    .label(</span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>        x<span class="op">=</span><span class="st">"(10-Binned) Predicted Probability"</span>,</span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>        y<span class="op">=</span><span class="st">"Observed Event Percentage</span><span class="ch">\n</span><span class="st">(Emperical Probability)"</span>,</span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>        title<span class="op">=</span><span class="st">"Calibration Plot"</span>,</span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a>    .layout(size<span class="op">=</span>(<span class="dv">5</span>, <span class="fl">4.5</span>))</span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="d3ecb8f8" class="cell quarto-layout-panel" data-layout="[50, 50]">

</div>
<div>

</div>
<div id="a1b37dd1" class="cell quarto-layout-panel" data-execution_count="68" data-layout="[50, 50]">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="logistic_files/figure-html/cell-30-output-1.png" class="img-fluid" width="470"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="logistic_files/figure-html/cell-30-output-2.png" class="img-fluid" width="470"></p>
</div>
</div>
</div>
</section>
<section id="evaluation-of-predicted-class" class="level3">
<h3 class="anchored" data-anchor-id="evaluation-of-predicted-class">Evaluation of predicted class</h3>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>예측된 확률을 기반으로 binary outcome/class으로 예측하여, 모형의 예측력을 평가</p>
<ul>
<li>예측된 확률값에 대해 임계치를 정하여, 예를 들어 0.5보다 크면 1, 0.5보다 작으면 0으로 분류하여, 이 binary 예측값과 실제값을 비교하여, 예측력을 평가</li>
<li>Confusion matrix</li>
<li>ROC curve</li>
</ul>
</div>
</div>
<div>

</div>
<div id="70c5a856" class="cell quarto-layout-panel" data-execution_count="140" data-layout="[4, 1]">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 80.0%;justify-content: center;">
<p><img src="logistic_files/figure-html/cell-31-output-1.png" class="img-fluid" width="768"></p>
</div>
</div>
</div>
<div>

</div>
<div id="67b8c19c" class="cell quarto-layout-panel" data-execution_count="141" data-layout="[4, 1]">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 80.0%;justify-content: center;">
<p><img src="logistic_files/figure-html/cell-32-output-1.png" class="img-fluid" width="768"></p>
</div>
</div>
</div>
<div>

</div>
<div id="46c722a0" class="cell quarto-layout-panel" data-execution_count="142" data-layout="[4, 1]">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 80.0%;justify-content: center;">
<p><img src="logistic_files/figure-html/cell-33-output-1.png" class="img-fluid" width="768"></p>
</div>
</div>
</div>
<p>Threshold: 0.5인 경우, accuracy rate: 0.78</p>
<div>

</div>
<div class="quarto-layout-panel" style="font-size: .9em; line-height: 1em;" data-layout="[30, -5, 50, 20]">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 28.6%;justify-content: center;">
<table class="caption-top table">
<thead>
<tr class="header">
<th style="text-align: left;">Predicted</th>
<th style="text-align: left;">Truth</th>
<th style="text-align: left;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">survied(0)</td>
<td style="text-align: left;">died(1)</td>
</tr>
<tr class="even">
<td style="text-align: left;">survied(0)</td>
<td style="text-align: left;">203</td>
<td style="text-align: left;">54</td>
</tr>
<tr class="odd">
<td style="text-align: left;">died(1)</td>
<td style="text-align: left;">19</td>
<td style="text-align: left;">54</td>
</tr>
</tbody>
</table>
</div>
<div class="quarto-figure-spacer quarto-layout-cell" style="flex-basis: 4.8%;justify-content: flex-start;">
<p>&nbsp;</p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 47.6%;justify-content: center;">
<table class="caption-top table">
<thead>
<tr class="header">
<th style="text-align: left;">Predicted</th>
<th style="text-align: left;">Truth</th>
<th style="text-align: left;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">survied(0)</td>
<td style="text-align: left;">died(1)</td>
</tr>
<tr class="even">
<td style="text-align: left;">survied(0)</td>
<td style="text-align: left;">True Negative</td>
<td style="text-align: left;">False Positive</td>
</tr>
<tr class="odd">
<td style="text-align: left;">died(1)</td>
<td style="text-align: left;">False Negative</td>
<td style="text-align: left;">True Positive</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>다른 threshold를 적용하면,</p>
<div>

</div>
<div class="quarto-layout-panel" style="font-size: .9em; line-height: 1em;" data-layout="[30, -8, 40, -22]">
<div class="quarto-layout-row">
<div class="column quarto-layout-cell" style="flex-basis: 30.0%;justify-content: center;">
<p>Threshold: 0.1인 경우,</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th style="text-align: left;">Predicted</th>
<th style="text-align: left;">Truth</th>
<th style="text-align: left;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">survied(0)</td>
<td style="text-align: left;">died(1)</td>
</tr>
<tr class="even">
<td style="text-align: left;">survied(0)</td>
<td style="text-align: left;">42</td>
<td style="text-align: left;">4</td>
</tr>
<tr class="odd">
<td style="text-align: left;">died(1)</td>
<td style="text-align: left;">180</td>
<td style="text-align: left;">104</td>
</tr>
</tbody>
</table>
<p>Accuracy rate: 0.44</p>
</div>
<div class="quarto-figure-spacer quarto-layout-cell" style="flex-basis: 8.0%;justify-content: flex-start;">
<p>&nbsp;</p>
</div>
<div class="column quarto-layout-cell" style="flex-basis: 40.0%;justify-content: center;">
<p>Threshold: 0.9인 경우</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th style="text-align: left;">Predicted</th>
<th style="text-align: left;">Truth</th>
<th style="text-align: left;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">survied(0)</td>
<td style="text-align: left;">died(1)</td>
</tr>
<tr class="even">
<td style="text-align: left;">survied(0)</td>
<td style="text-align: left;">222</td>
<td style="text-align: left;">104</td>
</tr>
<tr class="odd">
<td style="text-align: left;">died(1)</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">4</td>
</tr>
</tbody>
</table>
<p>Accuracy rate: 0.68</p>
</div>
<div class="quarto-figure-spacer quarto-layout-cell" style="flex-basis: 22.0%;justify-content: flex-start;">
<p>&nbsp;</p>
</div>
</div>
</div>
<details class="code-fold">
<summary>code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> accuracy_score</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> ISLP <span class="im">import</span> confusion_table</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="co"># cutoff = 0.5</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>cm <span class="op">=</span> confusion_table(test_pred[<span class="st">"pred_class"</span>], test_pred[<span class="st">"y"</span>])</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>score <span class="op">=</span> accuracy_score(test_pred[<span class="st">"y"</span>], test_pred[<span class="st">"pred_class"</span>])</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>display(cm)</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Accuracy rate: </span><span class="sc">{</span>score<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a><span class="co"># cutoff = 0.1</span></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>cm <span class="op">=</span> confusion_table(test_pred[<span class="st">"pred_prob"</span>] <span class="op">&gt;</span> <span class="fl">0.1</span>, test_pred[<span class="st">"y"</span>])</span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>score <span class="op">=</span> accuracy_score(test_pred[<span class="st">"y"</span>], test_pred[<span class="st">"pred_prob"</span>] <span class="op">&gt;</span> <span class="fl">0.1</span>)</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>display(cm)</span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Accuracy rate: </span><span class="sc">{</span>score<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a><span class="co"># cutoff = 0.9</span></span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>cm <span class="op">=</span> confusion_table(test_pred[<span class="st">"pred_prob"</span>] <span class="op">&gt;</span> <span class="fl">0.9</span>, test_pred[<span class="st">"y"</span>])</span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a>score <span class="op">=</span> accuracy_score(test_pred[<span class="st">"y"</span>], test_pred[<span class="st">"pred_prob"</span>] <span class="op">&gt;</span> <span class="fl">0.9</span>)</span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a>display(cm)</span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Accuracy rate: </span><span class="sc">{</span>score<span class="sc">:.2f}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="b1b466d7" class="cell quarto-layout-panel" data-execution_count="69" data-layout="[20, -5, 30, 45]">

</div>
</section>
<section id="분류모형의-성능을-평가하기-위한-여러-지표들" class="level3">
<h3 class="anchored" data-anchor-id="분류모형의-성능을-평가하기-위한-여러-지표들">분류모형의 성능을 평가하기 위한 여러 지표들</h3>
<p><strong><em>Precision &amp; Recall</em></strong>: 정보 검색 시스템의 탐색 능력을 평가하는데에서 유래</p>
<ul>
<li>Precision (정밀도): <span class="math inline">\(\hat{y}=1\)</span>일 때, <span class="math inline">\(y=1\)</span>일 확률
<ul>
<li>시스템이 스팸으로 분류한 이메일 중 실제 스팸인 이메일의 비율
<ul>
<li>높은 precision은 스팸으로 잘못 분류된 정상 이메일이 적다는 것을 의미</li>
<li>하지만, 스팸 이메일이 정상 이메일함에 나타날 수 있음.</li>
</ul></li>
<li>정보검색에서 반환된 문서들 중 실제로 관련 있는 문서의 비율
<ul>
<li>높은 precision은 사용자가 검색 결과에서 불필요한 정보를 적게 얻고, 대부분 유용한 정보를 얻는다는 것을 의미</li>
<li>하지만, 관련은 있지만 놓친 정보는 많을 수 있음.</li>
<li>검색 결과의 정확도를 평가</li>
</ul></li>
<li>검사를 통해 암으로 진단받은 사람이 실제로 암을 가지고 있을 확률
<ul>
<li>높은 precision은 암 진단을 받은 사람에게 잘못된 암 진단을 내리지 않는 것을 의미</li>
</ul></li>
</ul></li>
<li>Recall (재현율): <span class="math inline">\(y=1\)</span>일 때, <span class="math inline">\(\hat{y}=1\)</span>일 확률
<ul>
<li>실제 스팸 이메일 중에서 시스템이 스팸으로 올바르게 분류한 비율
<ul>
<li>높은 recall은 대부분의 스팸 이메일이 정확히 스팸으로 분류된다는 것을 의미</li>
<li>하지만, 정상 이메일이 스팸함으로 분류될 수 있음.</li>
</ul></li>
<li>정보검색에서 관련 문서들 중에서 실제로 시스템이 반환한 문서의 비율
<ul>
<li>높은 recall은 사용자가 찾고자 하는 모든 관련 정보를 검색 결과에서 얻을 수 있다는 것을 의미</li>
<li>하지만, 관련 없는 정보도 많이 포함될 수 있음.</li>
<li>검색 시스템의 탐색 능력을 평가</li>
</ul></li>
<li>실제로 암을 가진 사람 중에서 검사를 통해 암으로 진단받은 사람의 비율
<ul>
<li>높은 recall은 암 환자를 놓치지 않고 모두 찾아낸다는 것을 의미</li>
</ul></li>
<li>참 양성, true positive rate (TPR), 또는 sensitivity라고도 함</li>
</ul></li>
</ul>
<p><em>precision &amp; recall trade-off</em>: 이 둘 사이에는 종종 상충 관계가 있음. Precision을 높이기 위해 예측 확률에 대한 더 엄격한 기준을 사용하면 recall이 낮아질 수 있고, 반대로 recall을 높이기 위해 더 느슨한 기준을 사용하면 precision이 낮아질 수 있음.</p>
<ul>
<li><p>정보 검색의 맥락: precision을 높여 사용자가 불필요한 정보를 받지 않게 해주며, recall을 높여 필요한 정보를 놓치지 않도록 함.</p></li>
<li><p>스팸 필터링의 맥락: precision을 높여 자주 스팸 메일함을 확인하지 않아도 되도록 하며, recall을 높여 대부분의 스팸 이메일이 차단되어 정상 메일함에서 보이지 않도록 쾌적한 환경을 제공할 수 있음.</p></li>
</ul>
<p><strong><em>Sensitivity &amp; specificity</em></strong>: 의학 분야에서 진단 테스트의 정확성을 평가하는데에서 유래<br>
Precision &amp; recall이 주로 양성(positive) 클래스에 초점을 두는 반면, sensitivity &amp; specificity는 양성(positive)와 음성(negative) 클래스 모두에 초점을 둠.</p>
<p>특히, 이상치 탐지라든가 희귀 질병 진단 등 불균형 데이터셋에서는 precision &amp; recall이 더 유용할 수 있음.</p>
<ul>
<li>Sensitivity (민감도): <span class="math inline">\(y=1\)</span>일 때, <span class="math inline">\(\hat{y}=1\)</span>일 확률
<ul>
<li>Recall, true positive rate (TPR)</li>
<li>높은 민감도는 질병이 있는 사람을 놓치지 않고 모두 찾아내는 것(참 양성)을 의미</li>
</ul></li>
<li>Specificity (특이도): <span class="math inline">\(y=0\)</span>일 때, <span class="math inline">\(\hat{y}=0\)</span>일 확률
<ul>
<li>True negative rate (TNR)</li>
<li>실제로 질병이 없는 사람을 얼마나 잘 (질병이 없다고) 식별하는지(참 음성)를 나타냄</li>
<li>높은 특이도는 질병이 없는 사람에게 질병이 있다고 잘못 진단하지 않는 것을 의미함.
<ul>
<li>희귀 질병을 진단하는 경우, 정상인(negative)을 올바로 식별하는 것은 매우 쉽기 때문에 질병이 없는 사람에 대한 판별력이 과대추정될 수 있음; precision이 더 유용할 수 있음.</li>
</ul></li>
<li>1 - FPR (False Positive Rate; false alarm)</li>
<li>0, 1을 바꿨을 때의 즉, 0을 기준으로 했을 때의 recall</li>
<li>특이도가 높은 테스트라면 질병이 없다는 판정은 신뢰할 만함. 즉, 0(음성)을 기준으로한 sensitivity가 높은 것이 됨.</li>
</ul></li>
</ul>
<div class="callout callout-style-simple callout-note">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>거짓 음성 비율: False negative rate (FNR); <span class="math inline">\(y=1\)</span>일 때, <span class="math inline">\(\hat{y}=0\)</span>일 확률: 1 - sensitivity<br>
- 정상이라고 진단된 환자가 실제로 암인 확률</p>
<p>거짓 양성 비율: False positive rate (FPR) 또는 False alarm; <span class="math inline">\(y=0\)</span>일 때, <span class="math inline">\(\hat{y}=1\)</span>일 확률: 1 - specificity<br>
- 정상인 사람이 검사를 통해 암으로 진단받을 확률</p>
</div>
</div>
</div>
<!-- 
Sensitivity의 개념은 질병을 가진 환자를 놓치지 않는 능력, 즉 테스트의 민감도를 나타내며, 환자를 진단하는 과정에서 중요한 역할을 합니다.  
Specificity의 개념은 질병이 없는 사람에게 잘못된 양성 판정을 내리지 않는 능력, 즉 테스트의 특이성을 나타내며, 불필요한 치료나 추가 검사를 피하는 데 중요한 역할을 합니다.

예를 들어, 새로운 암 진단 테스트를 개발한다고 가정해봅시다.

높은 Sensitivity는 대부분의 암 환자를 정확히 진단할 수 있음을 의미합니다. 이는 암 환자를 놓치지 않기 때문에 중요한 지표입니다.  
높은 Specificity는 암이 없는 사람들에게 잘못된 암 진단을 내리지 않음을 의미합니다. 이는 불필요한 걱정과 치료를 피할 수 있기 때문에 중요한 지표입니다.

불균형 데이터셋의 경우
Precision과 recall은 분류 모델의 성능을 평가하는 데 매우 유용하지만, 데이터셋의 클래스가 불균형한 경우에는 상황이 다릅니다. 불균형 데이터셋에서는 대부분의 데이터가 한 클래스에 속하고 다른 클래스는 매우 적습니다. 예를 들어, 희귀 질병을 진단하는 테스트의 경우, 질병이 있는 환자 수가 매우 적을 수 있습니다.

Specificity는 질병이 없는 다수의 데이터를 평가하는 데 유리합니다. 다수 클래스에 대한 평가 지표로 적합합니다.
Sensitivity는 질병이 있는 소수의 데이터를 평가하는 데 유리합니다. 소수 클래스에 대한 평가 지표로 적합합니다.



틀린 예측의 비율

- 거짓 양성 비율, False positive rate (FPR): $\displaystyle P(\hat{y}=1 ~| ~y = 0)$ = 1 - TNR
    - 정상인 사람이 검사를 통해 암으로 진단받을 확률
    - 정상 이메일이 스팸으로 잘못 분류된 비율
        - 높은 FPR은 사용자에게 중요한 정상 이메일이 스팸 폴더로 이동될 가능성을 높입니다. 이는 사용자가 중요한 정보를 놓치게 할 수 있어 부정적인 영향을 미칩니다.
- 거짓 음성 비율, False negative rate (FNR): $\displaystyle P(\hat{y}=0 ~| ~y = 1)$ = 1 - TPR
    - 정상이라고 진단된 환자가 실제로 암인 확률
    - 스팸 이메일이 정상 이메일로 잘못 분류된 비율
        - 높은 FNR은 스팸 이메일이 사용자의 받은 편지함에 그대로 남아있게 할 가능성을 높입니다. 이는 사용자가 불필요한 스팸 메시지에 노출되게 하고, 중요한 이메일을 찾기 어려워지게 만듭니다.

FPR이 낮다면 중요한 이메일을 놓치지 않게 되며, 사용자 경험이 개선됩니다.  
FNR이 낮다면 스팸 이메일이 제대로 차단되어 사용자가 스팸 메시지로부터 보호됩니다.

의료 진단에서 FPR과 FNR의 중요성  
False Positive Rate (FPR): 높은 FPR은 질병이 없는 사람들을 불필요하게 걱정시키고, 추가적인 불필요한 검사나 치료로 이어질 수 있습니다. 이는 환자에게 신체적, 정신적 부담을 줄 수 있으며, 의료 자원을 낭비하게 만듭니다.  
False Negative Rate (FNR): 높은 FNR은 실제로 질병이 있는 환자들이 진단을 받지 못하게 하여 적절한 치료를 받지 못하게 할 수 있습니다. 이는 질병의 악화를 초래할 수 있으며, 심각한 경우 환자의 생명까지 위협할 수 있습니다.

가령, 유방암 스크리닝 검사를 고려해보겠습니다.

높은 FPR: 많은 여성이 실제로는 암이 없지만 검진 결과 암이 있다고 나와 추가 검사(예: 생검)를 받아야 하는 상황이 발생할 수 있습니다. 이는 불필요한 스트레스와 의료 비용을 증가시킵니다.  
높은 FNR: 실제로 암이 있는 여성이 검진 결과 암이 없다고 나와, 조기 치료의 기회를 놓치게 될 수 있습니다. 이는 암이 진행되어 치료가 더 어려워질 수 있습니다.  
의료 진단 테스트는 이러한 False Positive Rate과 False Negative Rate를 최소화하는 방향으로 설계되고 평가되어야 합니다. 최적의 진단 테스트는 높은 정확도뿐만 아니라, 환자 안전과 효율적인 의료 자원 사용을 보장하는 데 기여해야 합니다. -->
<!--

**정밀도(Precision)**가 중요한 상황은, **양성으로 예측한 것 중 실제 양성이 아닌 경우(FP)**가 발생했을 때 큰 비용이나 심각한 결과를 초래하는 경우입니다. 이를테면, 잘못된 양성 예측(False Positives)을 최소화하는 것이 중요한 모든 경우를 포함합니다.

정밀도가 중요한 구체적인 사례
1. 의료 분야 - 희귀 병의 진단
상황: 특정 희귀 질환을 진단하는 검사에서 많은 환자를 양성으로 진단했지만, 실제로는 건강한 경우.
이유: 잘못된 양성(FP)으로 인해 불필요한 정밀 검사를 수행하거나 환자와 가족에게 심리적, 금전적 부담을 줄 수 있습니다.
목표: 진단 검사의 Precision을 높여, 양성으로 예측된 케이스 중 실제 환자 비율을 높이는 것이 중요합니다.
2. 금융 분야 - 사기 탐지(Fraud Detection)
상황: 은행이 사기 거래를 탐지하려고 할 때, 정상 거래를 사기로 잘못 예측하는 경우.
이유: 잘못된 양성(FP)으로 인해 고객의 정상 거래가 차단되거나 경고가 발생하면, 고객 신뢰도가 떨어질 수 있습니다.
목표: Precision을 높여, 사기로 분류된 거래가 실제로 사기일 가능성을 최대화합니다.
3. 마케팅 분야 - 타겟 광고
상황: 특정 제품에 관심이 있는 사용자에게 광고를 타겟팅했으나, 관심이 없는 사용자에게 잘못 표시된 경우.
이유: 잘못된 양성(FP)으로 인해 광고 효율이 떨어지고, 불필요한 광고비가 발생하며, 사용자에게 부정적인 경험을 줄 수 있습니다.
목표: Precision을 높여, 광고를 본 사용자가 실제로 해당 제품에 관심이 있을 가능성을 극대화합니다.
4. 스팸 필터링
상황: 이메일 스팸 필터가 정상 이메일을 스팸으로 잘못 분류(FP)하여 중요한 메일을 놓치는 경우.
이유: FP로 인해 업무 메일이나 중요한 정보가 유실되면 큰 문제가 발생할 수 있습니다.
목표: Precision을 높여, 스팸으로 분류된 이메일이 실제로 스팸일 가능성을 높이는 것이 중요합니다.
5. 법 집행 및 범죄 예측
상황: 범죄 용의자를 예측하는 시스템에서 범죄와 관련 없는 사람을 용의자로 잘못 분류(FP)하는 경우.
이유: FP로 인해 무고한 사람이 불필요하게 조사 대상이 되거나 사회적 낙인을 받을 수 있습니다.
목표: Precision을 높여, 범죄 용의자로 분류된 사람이 실제로 관련이 있을 가능성을 극대화합니다.
6. 제품 추천 시스템
상황: 사용자가 관심 없어 할 제품을 추천 목록에 포함하는 경우.
이유: 잘못된 추천(FP)이 많아지면 사용자는 시스템의 신뢰도를 낮게 평가하고, 플랫폼 사용을 줄일 수 있습니다.
목표: Precision을 높여, 추천된 제품이 사용자의 관심사와 일치할 가능성을 극대화합니다. -->
<p>위의 confusion matrix로부터 지표들을 계산하면,</p>
<div>

</div>
<div class="quarto-layout-panel" style="font-size: .9em; line-height: 1em;" data-layout="[[50, -5, 50]]">
<div class="quarto-layout-row">
<div class="column quarto-layout-cell" style="flex-basis: 47.6%;justify-content: center;">
<p>Threshold: 0.1인 경우,</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th style="text-align: left;">Predicted</th>
<th style="text-align: left;">Truth</th>
<th style="text-align: left;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">survied(0)</td>
<td style="text-align: left;">died(1)</td>
</tr>
<tr class="even">
<td style="text-align: left;">survied(0)</td>
<td style="text-align: left;">42</td>
<td style="text-align: left;">4</td>
</tr>
<tr class="odd">
<td style="text-align: left;">died(1)</td>
<td style="text-align: left;">180</td>
<td style="text-align: left;">104</td>
</tr>
</tbody>
</table>
</div>
<div class="quarto-figure-spacer quarto-layout-cell" style="flex-basis: 4.8%;justify-content: flex-start;">
<p>&nbsp;</p>
</div>
<div class="column quarto-layout-cell" style="flex-basis: 47.6%;justify-content: center;">
<p>Threshold: 0.9인 경우</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th style="text-align: left;">Predicted</th>
<th style="text-align: left;">Truth</th>
<th style="text-align: left;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">survied(0)</td>
<td style="text-align: left;">died(1)</td>
</tr>
<tr class="even">
<td style="text-align: left;">survied(0)</td>
<td style="text-align: left;">222</td>
<td style="text-align: left;">104</td>
</tr>
<tr class="odd">
<td style="text-align: left;">died(1)</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">4</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div>

</div>
<div class="quarto-layout-panel" data-layout="[50, -5, 50]">
<div class="quarto-layout-row">
<div class="column quarto-layout-cell" style="flex-basis: 47.6%;justify-content: flex-start;">
<ul>
<li>recall = 104 / (4 + 104) = 0.96</li>
<li>precision = 104 / (180 + 104) = 0.37</li>
<li>specificity = 42 / (42 + 180) = 0.19</li>
<li>accuracy = (42 + 104) / (42 + 4 + 180 + 104) = 0.44</li>
</ul>
</div>
<div class="quarto-figure-spacer quarto-layout-cell" style="flex-basis: 4.8%;justify-content: flex-start;">
<p>&nbsp;</p>
</div>
<div class="column quarto-layout-cell" style="flex-basis: 47.6%;justify-content: flex-start;">
<ul>
<li>recall = 4 / (4 + 104) = 0.04</li>
<li>precision = 4 / (0 + 4) = 1.00</li>
<li>specificity = 222 / (222 + 0) = 1.00</li>
<li>accuracy = (222 + 4) / (222 + 104 + 0 + 4) = 0.68</li>
</ul>
</div>
</div>
</div>
<p><strong>Receiver operating characteristic (ROC) curve</strong></p>
<p>예측된 확률에 대한 임계치를 조정함에 따라 옳은 예측과 틀린 예측의 비율이 어떻게 달라지는지 살펴봄으로써 임계치를 설정하는데 도움을 줌</p>
<blockquote class="blockquote">
<p><em>잘못된 예측에 대한 비용이 다르다면, 특정 임계치를 선택하는 것을 고려해야 함</em></p>
</blockquote>
<div id="27f1a469" class="cell">
<details class="code-fold">
<summary>code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> roc_curve</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>fpr, tpr, thresholds <span class="op">=</span> roc_curve(test_pred.y, test_pred.pred_prob)</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>roc <span class="op">=</span> pd.DataFrame(</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">"thresholds"</span>: thresholds.<span class="bu">round</span>(<span class="dv">2</span>),</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">"False Pos"</span>: fpr,</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">"sensitivity(TPR)"</span>: tpr,</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">"specificity(TNR)"</span>: <span class="dv">1</span> <span class="op">-</span> fpr</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>roc.sort_values(<span class="st">"thresholds"</span>).head(<span class="dv">10</span>)</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a><span class="co">## ROC curve</span></span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a><span class="co"># 위에서 얻은 roc 데이터을 사용하여 그리거나</span></span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a><span class="co"># RocCurveDisplay를 이용</span></span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> RocCurveDisplay</span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>roc_display <span class="op">=</span> RocCurveDisplay(fpr<span class="op">=</span>fpr, tpr<span class="op">=</span>tpr).plot()</span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a><span class="co"># scikit-learn의 visualization 문서 참조</span></span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a><span class="co"># https://scikit-learn.org/stable/visualizations.html</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div>

</div>
<div id="afb388d5" class="cell quarto-layout-panel" data-execution_count="144" data-layout="[1, 1]">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="logistic_files/figure-html/cell-40-output-1.png" class="img-fluid" width="470"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="logistic_files/figure-html/cell-40-output-2.png" class="img-fluid" width="470"></p>
</div>
</div>
</div>
<div id="b5835016" class="cell">
<details class="code-fold">
<summary>code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> precision_recall_curve</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>precision, recall, thresholds <span class="op">=</span> precision_recall_curve(test_pred.y, </span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>test_pred.pred_prob)</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>pr <span class="op">=</span> pd.DataFrame(</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">"thresholds"</span>: np.append(thresholds.<span class="bu">round</span>(<span class="dv">2</span>), <span class="dv">1</span>),</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">"precision"</span>: precision,</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">"recall"</span>: recall,</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>        <span class="st">"f1-score"</span>: <span class="dv">2</span> <span class="op">*</span> precision <span class="op">*</span> recall <span class="op">/</span> (precision <span class="op">+</span> recall)</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>).query(<span class="st">"recall &gt; 0.1"</span>)</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>pr.sort_values(<span class="st">"thresholds"</span>).head(<span class="dv">10</span>)</span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a><span class="co"># precision-recall curve</span></span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a><span class="co"># 위에서 얻은 pr 데이터을 사용하여 그리거나</span></span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a><span class="co"># PrecisionRecallDisplay를 이용</span></span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> PrecisionRecallDisplay</span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a>pr_display <span class="op">=</span> PrecisionRecallDisplay(precision<span class="op">=</span>precision, recall<span class="op">=</span>recall).plot()</span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a><span class="co"># scikit-learn의 visualization 문서 참조</span></span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a><span class="co"># https://scikit-learn.org/stable/visualizations.html</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div>

</div>
<div id="836f22b1" class="cell quarto-layout-panel" data-execution_count="146" data-layout="[60, 40]">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 60.0%;justify-content: center;">
<p><img src="logistic_files/figure-html/cell-42-output-1.png" class="img-fluid" width="556"></p>
</div>
</div>
</div>
<p>위에서 언급한 클래스 불균형의 예들: 이상치 탐지, 희귀 질병 진단 등에서는 precision &amp; recall이 더 유용할 수 있음.</p>
<div id="acd6c54c" class="cell" data-execution_count="6">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="logistic_files/figure-html/cell-45-output-1.png" width="742" height="683" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p><strong>Classifier의 전체적 성능에 대한 지표</strong></p>
<p>ROC curve:</p>
<ul>
<li>AUC: Area Under the Curve = Concordance Index
<ul>
<li>각 specificity값에 대한 sensitivity의 합; 모형(classifier) 대한 전반적 평가</li>
<li>0.5: random guess, 1: perfect prediction</li>
</ul></li>
<li>Concordance Index(c-index): 모든 서로 다른 클래스의 Y쌍, 예를 들어 <span class="math inline">\((0_i, 1_j)\)</span>에 대해서 해당하는 예측된 확률의 크기가 <span class="math inline">\(p_i &lt; p_j\)</span> 인 비율, 즉 순서가 맞는(concordance) 비율</li>
</ul>
<div>

</div>
<div class="quarto-layout-panel" data-layout="[55, -2, 45]">
<div class="quarto-layout-row">
<div class="column quarto-layout-cell" style="flex-basis: 53.9%;justify-content: center;">
<p><img src="images/roc-curves.png" class="img-fluid"></p>
</div>
<div class="quarto-figure-spacer quarto-layout-cell" style="flex-basis: 2.0%;justify-content: flex-start;">
<p>&nbsp;</p>
</div>
<div class="column quarto-layout-cell" style="flex-basis: 44.1%;justify-content: flex-start;">
<p><br></p>
<p>위 blowdown 데이터셋 대한 모형의 AUC, concordance index 계산</p>
<div class="callout callout-style-default callout-tip callout-titled" title="Code">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-10-contents" aria-controls="callout-10" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Code
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-10" class="callout-10-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="sourceCode" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> roc_auc_score, auc</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>roc_auc <span class="op">=</span> roc_auc_score(test_pred.y, test_pred.pred_prob)</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"AUC: </span><span class="sc">{</span>roc_auc<span class="sc">:.2f}</span><span class="ss">"</span>)  <span class="co"># 또는 auc(fpr, tpr)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<p><em>AUC: 0.81</em></p>
<div class="callout callout-style-default callout-tip callout-titled" title="Code">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-11-contents" aria-controls="callout-11" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Code
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-11" class="callout-11-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="sourceCode" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> concordance(y, pred_prob):</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>    concord <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>    total <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>    test_pred <span class="op">=</span> pd.DataFrame({<span class="st">"y"</span>: y, <span class="st">"pred_prob"</span>: pred_prob})</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, case <span class="kw">in</span> test_pred.iterrows():</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>        other_cases <span class="op">=</span> test_pred[test_pred.index <span class="op">!=</span> idx]</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 같은 케이스 제외</span></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> other_cases[case[<span class="st">"y"</span>] <span class="op">!=</span> other_cases[<span class="st">"y"</span>]]</span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>        concord <span class="op">+=</span> (</span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>            (case[<span class="st">"y"</span>] <span class="op">-</span> df[<span class="st">"y"</span>] <span class="op">&gt;</span> <span class="dv">0</span>) <span class="op">==</span> (case[<span class="st">"pred_prob"</span>] <span class="op">-</span> df[<span class="st">"pred_prob"</span>] <span class="op">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>        ).<span class="bu">sum</span>()</span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>        total <span class="op">+=</span> <span class="bu">len</span>(df)</span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> concord <span class="op">/</span> total</span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Concordance index: </span><span class="sc">{</span>concordance(test_pred.y, test_pred.pred_prob)<span class="sc">:.2f}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<p><em>Concordance index: 0.81</em></p>
</div>
</div>
</div>
<p>Precision-recall:</p>
<ul>
<li>Average precision: the area under the precision-recall curve</li>
</ul>
<div class="callout callout-style-default callout-tip callout-titled" title="Code">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-12-contents" aria-controls="callout-12" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Code
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-12" class="callout-12-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="sourceCode" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> average_precision_score</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>average_precision <span class="op">=</span> average_precision_score(test_pred.y, test_pred.pred_prob)</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Average Precision: </span><span class="sc">{</span>average_precision<span class="sc">:.2f}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<p>Average Precision: 0.68</p>
<p><br></p>
<p><strong>The classification report in scikit-learn</strong><br>
<em>Thershold: 0.4인 경우,</em></p>
<div id="b9b47351" class="cell">
<details class="code-fold">
<summary>code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> classification_report, recall_score</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>threshold <span class="op">=</span> <span class="fl">.4</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>pred_class <span class="op">=</span> test_pred[<span class="st">"pred_prob"</span>] <span class="op">&gt;=</span> threshold</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(classification_report(test_pred[<span class="st">"y"</span>], pred_class))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>              precision    recall  f1-score   support

           0       0.86      0.82      0.84       222
           1       0.66      0.73      0.69       108

    accuracy                           0.79       330
   macro avg       0.76      0.77      0.77       330
weighted avg       0.80      0.79      0.79       330
</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled" title="specificity">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
specificity
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>specificity for positive = recall for negative: 0.82</li>
<li>macro avg of recall: sensitivity와 specificity의 평균: 0.77</li>
</ul>
</div>
</div>
<ul>
<li>F1-score = <span class="math inline">\(\displaystyle \left(\frac{\text{precision}^{-1} + \text{recall}^{-1}}{2}\right)^{-1}\)</span>
<ul>
<li>Precision과 recall의 조화평균</li>
<li>보수적인 지표임. 즉, precision과 recall 중 하나라도 낮으면 F1-score도 낮아짐</li>
</ul></li>
</ul>
<div>

</div>
<div id="607d0bd3" class="cell quarto-layout-panel" data-execution_count="253" data-layout="[5, 4]">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 55.6%;justify-content: center;">
<p><img src="logistic_files/figure-html/cell-51-output-1.png" class="img-fluid" width="552"></p>
</div>
</div>
</div>
<p><strong><em>Classifier로서 전반적인 모형의 성능 vs.&nbsp;특정 임계치에서의 모형의 성능 vs.&nbsp;확률모형</em></strong></p>
<ul>
<li>Classifier로서 전반적인 모형의 성능: AUC 등</li>
<li>비용을 고려한 특정 임계치에서의 모형의 성능
<ul>
<li>잘못된 예측에 대한 비용이 다르다면, 임계치를 조정하여, 잘못된 예측에 대한 비용을 줄일 수 있음</li>
<li>만약, 농작물에 대한 피해라고 가정하면,
<ul>
<li>Costs: 농작물 피해, 펜스 설치비, 노동력 등</li>
<li>Benefits: 수확물의 가치</li>
<li>거짓 음성을 낮춰야 하는 경우: 예를 들어, 농작물의 작은 피해도 심각한 결과를 초래하는 경우</li>
<li>거짓 양성을 낮춰야 하는 경우: 예를 들어, 농작물의 피해 예방을 위한 비용이 큰 경우</li>
</ul></li>
<li>만약, 와인 셀러가 와인의 품질(high:양성 vs.&nbsp;low:음성)을 성분들로 예측하는 모형을 만든다면, (in <em>Stefanie Molin</em>’s book)
<ul>
<li>Costs: 높은 품질의 와인을 낮은 품질로 예측하면, 와인 품평가에게 신뢰를 잃을 수 있음</li>
<li>Benefits: 낮은 품질의 와인을 높은 품질로 예측하면, 낮은 품질의 와인을 높은 가격에 팔아 수익으로 이어질 수 있음</li>
<li>거짓 음성을 낮춰야 하는 경우: 예를 들어, 영세한 와이너리가 수익이 중요한 경우</li>
<li>거짓 양성을 낮춰야 하는 경우: 예를 들어, 고품질의 와인을 생산하는 것으로 유명한 와이너리; 네임밸류를 유지하기 위해. 반면, 비싼 와인이 싸게 팔리는 것은 감당할 수 있음.</li>
</ul></li>
</ul></li>
<li>확률모형: 확률을 정확히 예측하는 모형의 추구;
<ul>
<li>확률값 혹은 확률 분포(Bayesian 접근)로 communicate</li>
<li>Decision maker는 당사자</li>
</ul></li>
</ul>
</section>
</section>
<section id="decision-boundary" class="level2">
<h2 class="anchored" data-anchor-id="decision-boundary">Decision Boundary</h2>
<p>앞선, Log odds(logit): &nbsp; <span class="math inline">\(\displaystyle log\left(\frac{\hat{p}}{1 - \hat{p}}\right)  = b_0 + b_1 \cdot X\)</span><br>
예측변수가 2개라면,</p>
<p>Log odds(logit): &nbsp; <span class="math inline">\(\displaystyle log\left(\frac{\hat{p}}{1 - \hat{p}}\right)  = b_0 + b_1 \cdot X_1 + b_2 \cdot X_2\)</span></p>
<p>또는 <span class="math inline">\(\displaystyle \hat p = \sigma(b_0 + b_1 \cdot X_1 + b_2 \cdot X_2)\)</span>, &nbsp; <span class="math inline">\(\displaystyle \sigma := \frac{1}{1 + e^{-x}}\)</span></p>
<ul>
<li>왼편의 logit 함수(또는 sigmoid 함수)는 증가함수이므로, threshold를 정하면 선형 결정 경계(decision boundary)가 나타남: hyperplane</li>
<li>비선형 함수로 모형을 세우면, decision boundary가 비선형으로 나타남.
<ul>
<li>예를 들어, <span class="math inline">\(b_0 + b_1 \cdot X + b_2 \cdot X^2\)</span> 등</li>
</ul></li>
</ul>
<p>밑은 두 예측변수 <span class="math inline">\(X_1= log2d\)</span> (diameter)와 <span class="math inline">\(X_2=s\)</span> (severity)로 나무가 쓰러질지 여부를 선형함수로 만들었을 때의 decision boundary (threshold=0.5)<br>
즉, Log odds(logit): &nbsp; <span class="math inline">\(\displaystyle log\left(\frac{\hat{p}}{1 - \hat{p}}\right)  = b_0 + b_1 \cdot X_1 + b_2 \cdot X_2\)</span></p>
<div id="4fb9d3cc" class="cell" data-execution_count="96">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="logistic_files/figure-html/cell-55-output-1.png" width="622" height="448" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p><strong>BodyM Dataset</strong></p>
<p><a href="https://aws.amazon.com/marketplace/pp/prodview-w3762gcflmhzk#overview">AWS: BodyM Dataset</a></p>
<ul>
<li>2,779명 대상으로 8,324장의 정면 및 측면 실루엣 사진과 키, 몸무게, 그리고 14가지 신체 측정치 제공</li>
<li>인종 분포: 백인 40%, 아시아인 30%, 흑인/아프리카계 미국인 14%, 아메리카 원주민 또는 알래스카 원주민 1%, 기타 15%(히스패닉 15%)</li>
</ul>
<p><span class="math inline">\(Y\)</span> = 성별,<br>
<span class="math inline">\(X_1\)</span> = 키(height), <span class="math inline">\(X_2\)</span> = 어깨 너비(shoulder-breath)에 대한 2차항을 포함한 선형함수로 모형을 세웠을 때의 decision boundary</p>
<div class="columns">
<div class="column" style="width:70%;">
<p><a href="images/bodyM-decision-boundary.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1"><img src="images/bodyM-decision-boundary.png" class="img-fluid" width="650"></a></p>
</div><div class="column" style="width:30%;">
<p><a href="images/bodyM-surface.png" class="lightbox" data-gallery="quarto-lightbox-gallery-2"><img src="images/bodyM-surface.png" class="img-fluid" width="350"></a></p>
<p><img src="images/male-2.png" height="190"> <img src="images/female-2.png" height="190"></p>
</div>
</div>
<div class="columns">
<div class="column" style="width:50%;">
<p><img src="images/bodyM-KDE-1.png" class="img-fluid"></p>
</div><div class="column" style="width:50%;">
<p><img src="images/bodyM-KDE-2.png" class="img-fluid"></p>
</div>
</div>
<!-- [3d surface](https://claude.ai/public/artifacts/bb394bef-ce25-4dde-8f18-357f142affb3) -->
</section>
<section id="basis-functions" class="level2">
<h2 class="anchored" data-anchor-id="basis-functions">Basis Functions</h2>
<p>기저 함수</p>
<p>관측치(input vector) <span class="math inline">\(\mathbf{x}\)</span>에 대해, basis function <span class="math inline">\(\phi(\mathbf{x})\)</span>를 사용하여, 비선형 모형을 선형모형으로 변환</p>
<p><span class="math display">\[\mathbf{y} = b_0 + b_1 \cdot \phi_1(\mathbf{x}) + b_2 \cdot \phi_2(\mathbf{x}) + ... + b_n \cdot \phi_{m-1}(\mathbf{x})\]</span></p>
<p>예를 들어, 두 예측변수의 관측치 <span class="math inline">\(\mathbf{x} = (x_1, x_2) = (log2d, s)\)</span> (각각 diameter와 severity)에 대해서 모든 2차항을 추가한다면</p>
<p><span class="math display">\[\phi_i(\mathbf{x}): \mathbb{R}^2 \to \mathbb{R}\]</span></p>
<p>where <span class="math inline">\(\phi_1(\mathbf{x}) = x_1, ~ \phi_2(\mathbf{x}) = x_2, ~ \phi_3(\mathbf{x}) = x_1^2, ~ \phi_4(\mathbf{x}) = x_1 \cdot x_2, ~ \phi_5(\mathbf{x}) = x_2^2\)</span></p>
<ul>
<li>즉, 5개의 예측 변수가 생성: <span class="math inline">\(x_1, x_2, x_1^2, ~ x_1 \cdot x_2, ~x_2^2\)</span></li>
<li>이는 2차원 예측변수 공간을 5차원으로 확장하는 것과 같음: <span class="math inline">\((x_1, x_2) \rightarrow (\phi_1, \phi_2, \phi_3, \phi_4, \phi_5)\)</span></li>
<li>이는 Kernel trick과 유사함: 고차원으로 변환하여 선형모형을 적용하는 것</li>
<li>Feature engineering의 일종임. Deep learning에서는 연구자가 직접 만들기보다는 모형이 학습할 수 있도록 함.</li>
</ul>
<div id="113a7c73" class="cell" data-execution_count="77">
<details class="code-fold">
<summary>code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 2차식을 추가</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> PolynomialFeatures</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LogisticRegression</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> ISLP <span class="im">import</span> confusion_table</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> accuracy_score</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>poly <span class="op">=</span> PolynomialFeatures(degree<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>X_train_poly <span class="op">=</span> poly.fit_transform(X_train)</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>X_test_poly <span class="op">=</span> poly.transform(X_test)</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>lr_poly <span class="op">=</span> LogisticRegression(penalty<span class="op">=</span><span class="va">None</span>, max_iter<span class="op">=</span><span class="dv">1000</span>)</span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>lr_blowsdn_poly <span class="op">=</span> lr_poly.fit(X_train_poly, y_train)</span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>test_pred <span class="op">=</span> X_test.assign(</span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span>y_test,</span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a>    pred_prob<span class="op">=</span>lr_blowsdn_poly.predict_proba(X_test_poly)[:, <span class="dv">1</span>],  <span class="co"># 확률값</span></span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>    pred_class<span class="op">=</span>lr_blowsdn_poly.predict(X_test_poly),  <span class="co"># 클래스</span></span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a><span class="co"># cutoff = 0.5</span></span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a>cm <span class="op">=</span> confusion_table(test_pred[<span class="st">"pred_class"</span>], test_pred[<span class="st">"y"</span>])</span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a>score <span class="op">=</span> accuracy_score(test_pred[<span class="st">"y"</span>], test_pred[<span class="st">"pred_class"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="fig-kernel-trick" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-fig" id="fig-kernel-trick-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: Logistic Regression Decision Boundary with Kernel Tricks
</figcaption>
<div aria-describedby="fig-kernel-trick-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-kernel-trick" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-dim-5" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<figcaption class="quarto-float-caption-top quarto-subfloat-caption quarto-subfloat-fig" id="fig-dim-5-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) <span class="math inline">\(\phi: (x_1, x_2) \rightarrow (x_1, x_2, x_1^2, x_1 x_2, x_2^2) \in \mathbb{R^5}\)</span>
</figcaption>
<div aria-describedby="fig-dim-5-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/logistic-kernel-1.png" class="img-fluid figure-img" data-ref-parent="fig-kernel-trick">
</div>
</figure>
</div>
</div>
<div class="quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-kernel-trick" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-dim-3" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<figcaption class="quarto-float-caption-top quarto-subfloat-caption quarto-subfloat-fig" id="fig-dim-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) <span class="math inline">\(\phi: (x_1, x_2) \rightarrow (x_1, x_2, x_1^2 + x_2^2) \in \mathbb{R^3}\)</span>
</figcaption>
<div aria-describedby="fig-dim-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/logistic-kernel-2.png" class="img-fluid figure-img" data-ref-parent="fig-kernel-trick">
</div>
</figure>
</div>
</div>
</div>
</div>
</figure>
</div>
<p>선형모형은 basis function을 고려하면 간단한 neural network(신경망)으로 볼 수 있음.</p>
<p><img src="images/neural-network3.png" class="img-fluid" width="420"></p>
<p>자주 사용되는 basis function</p>
<ul>
<li>Polynomial basis: <span class="math inline">\(\phi_i(x) = \mathbf{x}^i\)</span></li>
<li>Gaussian (Radial) basis: <span class="math inline">\(\displaystyle \phi_i(\mathbf{x}) = \exp\left(-\frac{||\mathbf{x} - \mu_i||^2}{2 s^2}\right)\)</span></li>
<li>Sigmoidal basis: <span class="math inline">\(\displaystyle \phi_i(\mathbf{x}) = \sigma\left(\frac{||\mathbf{x} - \mu_i||}{s}\right)\)</span>, <span class="math inline">\(\displaystyle \sigma(x) = \frac{1}{1 + e^{-x}}\)</span></li>
</ul>
<div class="columns">
<div class="column" style="width:50%;">
<p>다른 모형에서도 유연하게 비슷한 아이디어를 적용할 수 있음.</p>
<ul>
<li>가령, KNN에서 이웃하는 데이터들 간의 거리를 고려해서 확률을 계산할 수 있음.<br>
</li>
<li>즉, Gaussian의 분포에 비례하여 근접한 이웃에 더 큰 가중치를 부여함.</li>
</ul>
</div><div class="column" style="width:50%;">
<p><img src="images/knn-gaussian-kernel.png" class="img-fluid" width="250"></p>
</div>
</div>
<div id="0dadd8e4" class="cell">
<details class="code-fold">
<summary>KNN with Gaussian kernel</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> gaussian_kernel(distances, sigma<span class="op">=</span><span class="dv">1</span>):</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">"""Calculates Gaussian kernel weights."""</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> np.exp(<span class="op">-</span>distances<span class="op">**</span><span class="dv">2</span> <span class="op">/</span> (<span class="dv">2</span> <span class="op">*</span> sigma<span class="op">**</span><span class="dv">2</span>))</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Create KNN classifier with custom weights</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>knn_gaussin <span class="op">=</span> KNeighborsClassifier(n_neighbors<span class="op">=</span><span class="dv">10</span>, weights<span class="op">=</span><span class="kw">lambda</span> x: gaussian_kernel(x, sigma<span class="op">=</span><span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="neural-networkdeep-learning" class="level2">
<h2 class="anchored" data-anchor-id="neural-networkdeep-learning">Neural Network/Deep Learning</h2>
<ul>
<li>앞서 Gaussian basis (radial basis) function (RBF)과 같은 방식으로 비선형 모형 변환이 유용하나, 계산량이 많고, 과적합을 방지하기 위한 조심스러운 정규화가 필요함.</li>
<li>또는, Support Vector Machine (SVM)도 비슷하게 basis function을 이용해 비선형 모형을 만드나, 확률적 출력을 제공하지 않고 다중 클래스의 일반화가 어려움.</li>
<li>RBF 및 SVM 같은 모델은 최근에는 deep learning에 의해 대체되고 있음.
<ul>
<li>대규모 데이터셋을 효과적으로 활용 가능.</li>
<li>깊은 계층 구조의 표현을 학습하여 복잡한 예측 문제에서 높은 정확도 달성.</li>
</ul></li>
</ul>
<div style="line-height: 1.5em; font-size: .9em">
<p>FIGURE 10.1. <em>Neural network with a single hidden layer. The hidden layer computes activations <span class="math inline">\(A_k = h_k(X)\)</span> that are nonlinear transformations of linear combinations of the inputs <span class="math inline">\(X1, X2, . . . , Xp\)</span>. Hence these <span class="math inline">\(A_k\)</span> are not directly observed. The functions <span class="math inline">\(h_k(\cdot)\)</span> are not fixed in advance, but are learned during the training of the network. The output layer is a linear model that uses these activations <span class="math inline">\(A_k\)</span> as inputs, resulting in a function <span class="math inline">\(f(X)\)</span>.</em></p>
</div>
<div class="columns">
<div class="column" style="line-height: 1.5em; font-size: .9em">
<p><a href="images/neural-network1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-3"><img src="images/neural-network1.png" class="img-fluid"></a></p>
</div><div class="column" style="line-height: 1.5em; font-size: .9em">
<p><a href="images/neural-network2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-4"><img src="images/neural-network2.png" class="img-fluid"></a><br>
FIGURE 10.2. <em>Activation functions. The piecewise-linear ReLU function is popular for its efficiency and computability. We have scaled it down by a factor of five for ease of comparison.</em></p>
</div>
</div>
<ul>
<li>Hidden layers: <span class="math inline">\(A_k = g(w_{k0} + w_{k1}X_1 + w_{k2}X_2 + w_{k3}X_3 + w_{k4}X_4)\)</span>
<ul>
<li><span class="math inline">\(g\)</span>는 activation function으로 logistic에서처럼 sigmoid나 현대적으로는 ReLU를 사용</li>
</ul></li>
<li>각 <span class="math inline">\(A_k\)</span>가 1에 가까우면 firing, 0에 가까우면 silent한다고 마치 뇌의 뉴런이 신호가 전달되는 것에 비유</li>
<li><span class="math inline">\(Y(X) = \beta_0 + \beta_1 A_1 + \beta_2 A_2 + \cdots + \beta_5 A_5\)</span></li>
</ul>
<p><strong>The handwritten digit recognition example</strong></p>
<ul>
<li>1980년대 후반 숫자를 인식하는 문제가 신경망 기술의 발전에 큰 촉매로 작용했음.</li>
<li>신경망의 구조의 개선을 거쳐 인간 수준의 성능을 달성하는데 30년 이상 걸렸음.</li>
</ul>
<p>아래 28x28 pixels의 음영을 나타내는 0~255(8bit) 값을 입력값으로 받음.</p>
<div>

</div>
<div class="quarto-layout-panel" data-layout="[1, 1]">
<div class="quarto-layout-row">
<div class="column quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<ul>
<li>60,000개의 training set을 이용하여 학습</li>
<li>인풋 레이어의 유닛(unit)의 수: 28x28 = 784개 (예측변수의 수)</li>
<li>각각의 hidden layer의 유닛의 수는 256개, 128개</li>
<li>총 파라미터의 수는 235,146개; 예측변수보다 월등히 많음</li>
<li>한편 multinomial logistic으로 필요한 파라미터의 수는 785x9 = 7,065개</li>
</ul>
</div>
<div class="column quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><a href="images/handwritten-digit.png" class="lightbox" data-gallery="quarto-lightbox-gallery-5"><img src="images/handwritten-digit.png" class="img-fluid" width="600"></a></p>
</div>
</div>
</div>
<div class="columns">
<div class="column" style="width:62%;">
<p><a href="images/neural-network-multilayer.png" class="lightbox" data-gallery="quarto-lightbox-gallery-6"><img src="images/neural-network-multilayer.png" class="img-fluid"></a></p>
</div><div class="column" style="width:38%;">
<p><a href="images/NN-layers-digits.png" class="lightbox" data-gallery="quarto-lightbox-gallery-7"><img src="images/NN-layers-digits.png" class="img-fluid"></a></p>
<div style="line-height: 1.5em; font-size: .9em">
<p>Source: <a href="https://www.3blue1brown.com/lessons/neural-networks">3blue1brown</a></p>
</div>
</div>
</div>
<div style="line-height: 1.5em; font-size: .9em">
<p> Source: <em>An Introduction to Statistical Learning (2e)</em></p>
</div>
<p><strong>Convolutional Deep Belief Networks: Hierarchical Representations</strong></p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<figcaption>Figure 2. <em>The first layer bases (top) and the second layer bases (bottom) learned from natural images. Each second layer basis (filter) was visualized as a weighted linear combination of the first layer bases.</em></figcaption>
<p><a href="images/cnn-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-8" title="Figure 2. The first layer bases (top) and the second layer bases (bottom) learned from natural images. Each second layer basis (filter) was visualized as a weighted linear combination of the first layer bases."><img src="images/cnn-1.png" class="img-fluid figure-img" width="400" alt="Figure 2. The first layer bases (top) and the second layer bases (bottom) learned from natural images. Each second layer basis (filter) was visualized as a weighted linear combination of the first layer bases."></a></p>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<figcaption>Figure 3. <em>Columns 1-4: the second layer bases (top) and the third layer bases (bottom) learned from specific object categories. Column 5: the second layer bases (top) and the third layer bases (bottom) learned from a mixture of four object categories (faces, cars, airplanes, motorbikes).</em></figcaption>
<p><a href="images/cnn-2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-9" title="Figure 3. Columns 1-4: the second layer bases (top) and the third layer bases (bottom) learned from specific object categories. Column 5: the second layer bases (top) and the third layer bases (bottom) learned from a mixture of four object categories (faces, cars, airplanes, motorbikes)."><img src="images/cnn-2.png" class="img-fluid figure-img" alt="Figure 3. Columns 1-4: the second layer bases (top) and the third layer bases (bottom) learned from specific object categories. Column 5: the second layer bases (top) and the third layer bases (bottom) learned from a mixture of four object categories (faces, cars, airplanes, motorbikes)."></a></p>
</figure>
</div>
<div style="line-height: 1.5em; font-size: .9em">
<p>Source: <a href="https://web.eecs.umich.edu/~honglak/icml09-ConvolutionalDeepBeliefNetworks.pdf">Convolutional Deep Belief Networks</a></p>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<figcaption>Google Neural Network Playground</figcaption>
<p><a href="https://playground.tensorflow.org/"><img src="images/nn-playground.png" class="img-fluid figure-img" alt="Google Neural Network Playground"></a></p>
</figure>
</div>
</section>
<section id="multiclass-k-2" class="level2">
<h2 class="anchored" data-anchor-id="multiclass-k-2">Multiclass (K &gt; 2)</h2>
<p><strong>Multinomial logistic regression</strong></p>
<p>클래스 <span class="math inline">\(C_k\)</span>에 속할 확률을 예측하는 모형: Base 클래스를 기준으로 나머지 클래스에 대한 확률을 예측<br>
Binary 경우에서의 확률 <span class="math inline">\(\displaystyle P(Y=1|X=x) = \frac{1}{1+e^{-(b_0 + b_1 \cdot x)}}=\frac{e^{b_0 + b_1 \cdot x}}{1 + e^{b_0 + b_1 \cdot x}}\)</span>을 다음과 같이 확장할 수 있음.</p>
<ul>
<li><span class="math inline">\(\displaystyle P(Y=C_k|X=x) = \frac{e^{\beta_{k0} + \beta_{k1} \cdot x}}{1 + \sum_{j=1}^{K-1} e^{\beta_{j0} + \beta_{j1} \cdot x}}, ~~ k = 1, 2, ..., K-1\)</span></li>
<li><span class="math inline">\(k=K\)</span> (Base 클래스)의 경우 <span class="math inline">\(\displaystyle P(Y=C_K|X=x) = \frac{1}{1 + \sum_{j=1}^{K-1} e^{\beta_{j0} + \beta_{j1} \cdot x}}\)</span></li>
</ul>
<p>이 때, 마지막 클래스 <span class="math inline">\(C_K\)</span>에 대한 클래스 <span class="math inline">\(C_k\)</span>의 비율은 다음과 같이 나타남.</p>
<p><span class="math inline">\(\displaystyle log\left(\frac{P(Y=C_k|X=x)}{P(Y=C_K|X=x)}\right) = \beta_{k0} + \beta_{k1} \cdot x\)</span></p>
<p>이는 binary경우 <span class="math inline">\(log(odds)\)</span> 인 <span class="math inline">\(\displaystyle log\left(\frac{\hat{p}}{1 - \hat{p}}\right) = b_0 + b_1 \cdot x\)</span>의 확장으로 볼 수 있음.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Machine learning에서는 주로 base 클래스 없이 모든 클래스에 대한 확률을 예측:</p>
<p>Softmax coding: <span class="math inline">\(\displaystyle P(Y=C_k|X=x) = \frac{e^{\beta_{k0} + \beta_{k1} \cdot x}}{\sum_{j=1}^{K} e^{\beta_{j0} + \beta_{j1} \cdot x}}\)</span></p>
<p>두 클래스 <span class="math inline">\(C_k\)</span>와 <span class="math inline">\(C_{k'}\)</span>의 사이의 확률의 비율은</p>
<p><span class="math inline">\(\displaystyle log\left(\frac{P(Y=C_k|X=x)}{P(Y=C_{k'}|X=x)}\right) = (\beta_{k0} - \beta_{k'0}) + (\beta_{k1} - \beta_{k'1}) \cdot x\)</span></p>
</div>
</div>
<section id="blowdown-data" class="level3">
<h3 class="anchored" data-anchor-id="blowdown-data">Blowdown data</h3>
<p>가령, 나무의 종(9 species)을 분류하는 문제를 생각해보면,<br>
나무의 두께(<code>log2d</code>), 쓰러졌는지 여부(<code>y</code>), 피해 심각도(<code>s</code>)로 9개의 종에 대한 확률을 예측하는 모형을 만들 수 있음.</p>
<details class="code-fold">
<summary>Load data</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Multinomial logistic regression</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>blowdown <span class="op">=</span> pd.read_csv(<span class="st">'data/blowdown2.csv'</span>)</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> blowdown.drop(columns<span class="op">=</span>[<span class="st">"spp"</span>, <span class="st">"d"</span>])</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> blowdown[<span class="st">"spp"</span>]  <span class="co"># classify the species</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>blowdown</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="4fd95481" class="cell quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: left;" data-quarto-table-cell-role="th">d</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">s</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">y</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">spp</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">log2d</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;" data-quarto-table-cell-role="th">0</td>
<td style="text-align: left;">9.00</td>
<td style="text-align: left;">0.02</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">balsam fir</td>
<td style="text-align: left;">3.17</td>
</tr>
<tr class="even">
<td style="text-align: left;" data-quarto-table-cell-role="th">1</td>
<td style="text-align: left;">14.00</td>
<td style="text-align: left;">0.02</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">balsam fir</td>
<td style="text-align: left;">3.81</td>
</tr>
<tr class="odd">
<td style="text-align: left;" data-quarto-table-cell-role="th">2</td>
<td style="text-align: left;">18.00</td>
<td style="text-align: left;">0.02</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">balsam fir</td>
<td style="text-align: left;">4.17</td>
</tr>
<tr class="even">
<td style="text-align: left;" data-quarto-table-cell-role="th">...</td>
<td style="text-align: left;">...</td>
<td style="text-align: left;">...</td>
<td style="text-align: left;">...</td>
<td style="text-align: left;">...</td>
<td style="text-align: left;">...</td>
</tr>
<tr class="odd">
<td style="text-align: left;" data-quarto-table-cell-role="th">3663</td>
<td style="text-align: left;">19.00</td>
<td style="text-align: left;">0.98</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">jackpine</td>
<td style="text-align: left;">4.25</td>
</tr>
<tr class="even">
<td style="text-align: left;" data-quarto-table-cell-role="th">3664</td>
<td style="text-align: left;">37.00</td>
<td style="text-align: left;">0.98</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">black ash</td>
<td style="text-align: left;">5.21</td>
</tr>
<tr class="odd">
<td style="text-align: left;" data-quarto-table-cell-role="th">3665</td>
<td style="text-align: left;">48.00</td>
<td style="text-align: left;">0.98</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">black ash</td>
<td style="text-align: left;">5.58</td>
</tr>
</tbody>
</table>

<p>3666 rows × 5 columns</p>
</div>
</div>
</div>
<div id="d38c1edb" class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># split the data into training and test sets</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(X, y, test_size<span class="op">=</span><span class="fl">0.5</span>, random_state<span class="op">=</span><span class="dv">0</span>, stratify<span class="op">=</span>y)</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>lr <span class="op">=</span> LogisticRegression(max_iter<span class="op">=</span><span class="dv">1000</span>)</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>lr.fit(X_train, y_train)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="03758dc7" class="cell" data-execution_count="41">
<details class="code-fold">
<summary>Predicted probability</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>pd.options.display.max_columns <span class="op">=</span> <span class="dv">15</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="co"># predicted probability</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>test_pred_prob <span class="op">=</span> pd.DataFrame(lr.predict_proba(X_test), columns<span class="op">=</span>lr.classes_)</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>pd.concat(</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>    [X_test.assign(target<span class="op">=</span>y_test).reset_index(drop<span class="op">=</span><span class="va">True</span>), test_pred_prob], axis<span class="op">=</span><span class="dv">1</span></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>) <span class="co"># 데이터셋 병합</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="41">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">s</th>
<th data-quarto-table-cell-role="th">y</th>
<th data-quarto-table-cell-role="th">log2d</th>
<th data-quarto-table-cell-role="th">target</th>
<th data-quarto-table-cell-role="th">aspen</th>
<th data-quarto-table-cell-role="th">balsam fir</th>
<th data-quarto-table-cell-role="th">black ash</th>
<th data-quarto-table-cell-role="th">black spruce</th>
<th data-quarto-table-cell-role="th">cedar</th>
<th data-quarto-table-cell-role="th">jackpine</th>
<th data-quarto-table-cell-role="th">paper birch</th>
<th data-quarto-table-cell-role="th">red maple</th>
<th data-quarto-table-cell-role="th">red pine</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0.61</td>
<td>1</td>
<td>4.58</td>
<td>paper birch</td>
<td>0.29</td>
<td>0.00</td>
<td>0.02</td>
<td>0.04</td>
<td>0.24</td>
<td>0.02</td>
<td>0.33</td>
<td>0.01</td>
<td>0.04</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>0.26</td>
<td>0</td>
<td>4.32</td>
<td>cedar</td>
<td>0.14</td>
<td>0.02</td>
<td>0.01</td>
<td>0.05</td>
<td>0.20</td>
<td>0.26</td>
<td>0.11</td>
<td>0.04</td>
<td>0.18</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>0.86</td>
<td>1</td>
<td>5.17</td>
<td>aspen</td>
<td>0.42</td>
<td>0.00</td>
<td>0.09</td>
<td>0.01</td>
<td>0.10</td>
<td>0.01</td>
<td>0.34</td>
<td>0.00</td>
<td>0.02</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1830</td>
<td>0.09</td>
<td>0</td>
<td>3.70</td>
<td>cedar</td>
<td>0.05</td>
<td>0.05</td>
<td>0.00</td>
<td>0.13</td>
<td>0.25</td>
<td>0.22</td>
<td>0.05</td>
<td>0.05</td>
<td>0.20</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1831</td>
<td>0.41</td>
<td>1</td>
<td>3.32</td>
<td>black spruce</td>
<td>0.05</td>
<td>0.01</td>
<td>0.00</td>
<td>0.33</td>
<td>0.44</td>
<td>0.02</td>
<td>0.06</td>
<td>0.02</td>
<td>0.06</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1832</td>
<td>0.20</td>
<td>0</td>
<td>3.00</td>
<td>cedar</td>
<td>0.01</td>
<td>0.05</td>
<td>0.00</td>
<td>0.31</td>
<td>0.24</td>
<td>0.12</td>
<td>0.01</td>
<td>0.06</td>
<td>0.21</td>
</tr>
</tbody>
</table>

<p>1833 rows × 13 columns</p>
</div>
</div>
</div>
<details class="code-fold">
<summary>Predicted class</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># prediction</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>test_pred <span class="op">=</span> X_test.assign(</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>    target<span class="op">=</span>y_test,</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>    pred_class<span class="op">=</span>lr.predict(X_test),</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>    pred_prob<span class="op">=</span>lr.predict_proba(X_test).<span class="bu">max</span>(axis<span class="op">=</span><span class="dv">1</span>),</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>test_pred</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="c05c74ec" class="cell quarto-layout-panel" data-execution_count="38" data-layout-ncol="2">
<div class="quarto-layout-row">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: left;" data-quarto-table-cell-role="th">s</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">y</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">log2d</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">target</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">pred_class</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">pred_prob</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;" data-quarto-table-cell-role="th">2811</td>
<td style="text-align: left;">0.61</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">4.58</td>
<td style="text-align: left;">paper birch</td>
<td style="text-align: left;">paper birch</td>
<td style="text-align: left;">0.33</td>
</tr>
<tr class="even">
<td style="text-align: left;" data-quarto-table-cell-role="th">1105</td>
<td style="text-align: left;">0.26</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">4.32</td>
<td style="text-align: left;">cedar</td>
<td style="text-align: left;">jackpine</td>
<td style="text-align: left;">0.26</td>
</tr>
<tr class="odd">
<td style="text-align: left;" data-quarto-table-cell-role="th">3566</td>
<td style="text-align: left;">0.86</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">5.17</td>
<td style="text-align: left;">aspen</td>
<td style="text-align: left;">aspen</td>
<td style="text-align: left;">0.42</td>
</tr>
<tr class="even">
<td style="text-align: left;" data-quarto-table-cell-role="th">...</td>
<td style="text-align: left;">...</td>
<td style="text-align: left;">...</td>
<td style="text-align: left;">...</td>
<td style="text-align: left;">...</td>
<td style="text-align: left;">...</td>
<td style="text-align: left;">...</td>
</tr>
<tr class="odd">
<td style="text-align: left;" data-quarto-table-cell-role="th">255</td>
<td style="text-align: left;">0.09</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">3.70</td>
<td style="text-align: left;">cedar</td>
<td style="text-align: left;">cedar</td>
<td style="text-align: left;">0.25</td>
</tr>
<tr class="even">
<td style="text-align: left;" data-quarto-table-cell-role="th">1934</td>
<td style="text-align: left;">0.41</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">3.32</td>
<td style="text-align: left;">black spruce</td>
<td style="text-align: left;">cedar</td>
<td style="text-align: left;">0.44</td>
</tr>
<tr class="odd">
<td style="text-align: left;" data-quarto-table-cell-role="th">816</td>
<td style="text-align: left;">0.20</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">3.00</td>
<td style="text-align: left;">cedar</td>
<td style="text-align: left;">black spruce</td>
<td style="text-align: left;">0.31</td>
</tr>
</tbody>
</table>

<p>1833 rows × 6 columns</p>
</div>
</div>
</div>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># confusion matrix</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>confusion_table(test_pred[<span class="st">"pred_class"</span>], test_pred[<span class="st">"y"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="7b00459b" class="cell quarto-layout-panel" data-layout="[5, 1]">
<div class="quarto-layout-row">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Truth</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">aspen</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">balsam fir</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">black ash</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">black spruce</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">cedar</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">jackpine</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">paper birch</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">red maple</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">red pine</th>
</tr>
<tr class="even">
<th style="text-align: left;" data-quarto-table-cell-role="th">Predicted</th>
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;" data-quarto-table-cell-role="th">aspen</td>
<td style="text-align: left;">38</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">6</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">7</td>
<td style="text-align: left;">12</td>
<td style="text-align: left;">30</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">7</td>
</tr>
<tr class="even">
<td style="text-align: left;" data-quarto-table-cell-role="th">balsam fir</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;" data-quarto-table-cell-role="th">black ash</td>
<td style="text-align: left;">2</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;" data-quarto-table-cell-role="th">black spruce</td>
<td style="text-align: left;">8</td>
<td style="text-align: left;">19</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">189</td>
<td style="text-align: left;">88</td>
<td style="text-align: left;">41</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">13</td>
<td style="text-align: left;">74</td>
</tr>
<tr class="odd">
<td style="text-align: left;" data-quarto-table-cell-role="th">cedar</td>
<td style="text-align: left;">63</td>
<td style="text-align: left;">7</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">111</td>
<td style="text-align: left;">278</td>
<td style="text-align: left;">46</td>
<td style="text-align: left;">79</td>
<td style="text-align: left;">25</td>
<td style="text-align: left;">76</td>
</tr>
<tr class="even">
<td style="text-align: left;" data-quarto-table-cell-role="th">jackpine</td>
<td style="text-align: left;">21</td>
<td style="text-align: left;">4</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">8</td>
<td style="text-align: left;">47</td>
<td style="text-align: left;">45</td>
<td style="text-align: left;">24</td>
<td style="text-align: left;">11</td>
<td style="text-align: left;">28</td>
</tr>
<tr class="odd">
<td style="text-align: left;" data-quarto-table-cell-role="th">paper birch</td>
<td style="text-align: left;">80</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">18</td>
<td style="text-align: left;">4</td>
<td style="text-align: left;">27</td>
<td style="text-align: left;">11</td>
<td style="text-align: left;">114</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">11</td>
</tr>
<tr class="even">
<td style="text-align: left;" data-quarto-table-cell-role="th">red maple</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;" data-quarto-table-cell-role="th">red pine</td>
<td style="text-align: left;">6</td>
<td style="text-align: left;">7</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">17</td>
<td style="text-align: left;">38</td>
<td style="text-align: left;">23</td>
<td style="text-align: left;">4</td>
<td style="text-align: left;">12</td>
<td style="text-align: left;">52</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Precision, Recall: <strong>one-versus-all(rest)</strong><br>
해당 클래스를 positive로 두고 나머지 클래스를 negative로 두어, 각 클래스에 대한 precision과 recall을 계산</p>
<div id="c722b74e" class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># classification report: one-versus-all</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(classification_report(test_pred[<span class="st">"y"</span>], test_pred[<span class="st">"pred_class"</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              precision    recall  f1-score   support

       aspen       0.38      0.17      0.24       218
  balsam fir       0.00      0.00      0.00        37
   black ash       0.33      0.04      0.07        25
black spruce       0.44      0.57      0.50       329
       cedar       0.41      0.57      0.48       485
    jackpine       0.24      0.25      0.25       178
 paper birch       0.43      0.45      0.44       251
   red maple       0.00      0.00      0.00        62
    red pine       0.33      0.21      0.26       248

    accuracy                           0.39      1833
   macro avg       0.28      0.25      0.25      1833
weighted avg       0.36      0.39      0.36      1833
</code></pre>
</div>
</div>
<div id="e5ed37f8" class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># accuracy</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(accuracy_score(test_pred[<span class="st">"y"</span>], test_pred[<span class="st">"pred_class"</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0.3911620294599018</code></pre>
</div>
</div>
</section>
<section id="mnist-digits-data" class="level3">
<h3 class="anchored" data-anchor-id="mnist-digits-data">MNIST digits data</h3>
<div id="2da0d460" class="cell">
<details class="code-fold">
<summary>Load data</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> tensorflow <span class="im">as</span> tf</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the MNIST dataset</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>(X_train, y_train), (X_test, y_test) <span class="op">=</span> tf.keras.datasets.mnist.load_data()</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a><span class="co"># randomly select a subset of the data</span></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">123</span>)</span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>n1, n2 <span class="op">=</span> <span class="dv">2000</span>, <span class="dv">2000</span>  <span class="co"># 2000 training and 2000 test samples</span></span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>idx1 <span class="op">=</span> np.random.randint(<span class="dv">0</span>, <span class="dv">60000</span>, n1)</span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a>idx2 <span class="op">=</span> np.random.randint(<span class="dv">0</span>, <span class="dv">10000</span>, n2)</span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a>X_train_sub <span class="op">=</span> X_train[idx1, :]</span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a>y_train_sub <span class="op">=</span> y_train[idx1]</span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a>X_test_sub <span class="op">=</span> X_test[idx2, :]</span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a>y_test_sub <span class="op">=</span> y_test[idx2]</span>
<span id="cb47-18"><a href="#cb47-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-19"><a href="#cb47-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Reshape the data</span></span>
<span id="cb47-20"><a href="#cb47-20" aria-hidden="true" tabindex="-1"></a>X_train_sub <span class="op">=</span> X_train_sub.reshape(n1, <span class="dv">28</span> <span class="op">*</span> <span class="dv">28</span>)  <span class="co"># 2-dim array: (2000, 784)</span></span>
<span id="cb47-21"><a href="#cb47-21" aria-hidden="true" tabindex="-1"></a>X_test_sub <span class="op">=</span> X_test_sub.reshape(n2, <span class="dv">28</span> <span class="op">*</span> <span class="dv">28</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="271ac531" class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit Logistic Regression with polynomial features</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> PolynomialFeatures</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create polynomial features</span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>poly <span class="op">=</span> PolynomialFeatures(degree<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>X_train_poly <span class="op">=</span> poly.fit_transform(X_train_sub)</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>X_test_poly <span class="op">=</span> poly.transform(X_test_sub)</span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the model</span></span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>lr <span class="op">=</span> LogisticRegression(max_iter<span class="op">=</span><span class="dv">1000</span>)</span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>lr.fit(X_train_poly, y_train_sub)</span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Prediction</span></span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a>y_pred_poly <span class="op">=</span> lr.predict(X_test_poly)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="9b4dc472" class="cell" data-execution_count="21">
<details class="code-fold">
<summary>Predicted probability</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>pd.options.display.max_columns <span class="op">=</span> <span class="dv">15</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a><span class="co"># predicted probability</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>test_pred_prob <span class="op">=</span> pd.DataFrame(lr.predict_proba(X_test_poly), columns<span class="op">=</span>lr.classes_)</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>test_pred_prob[<span class="st">"target"</span>] <span class="op">=</span> y_test_sub</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>test_pred_prob</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="21">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">0</th>
<th data-quarto-table-cell-role="th">1</th>
<th data-quarto-table-cell-role="th">2</th>
<th data-quarto-table-cell-role="th">3</th>
<th data-quarto-table-cell-role="th">4</th>
<th data-quarto-table-cell-role="th">5</th>
<th data-quarto-table-cell-role="th">6</th>
<th data-quarto-table-cell-role="th">7</th>
<th data-quarto-table-cell-role="th">8</th>
<th data-quarto-table-cell-role="th">9</th>
<th data-quarto-table-cell-role="th">target</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0.01</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.98</td>
<td>0.00</td>
<td>0.00</td>
<td>0.02</td>
<td>0.00</td>
<td>8</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>1.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>4</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>1.00</td>
<td>0.00</td>
<td>0.00</td>
<td>7</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1997</td>
<td>1.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1998</td>
<td>1.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1999</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>1.00</td>
<td>0.00</td>
<td>0.00</td>
<td>0.00</td>
<td>6</td>
</tr>
</tbody>
</table>

<p>2000 rows × 11 columns</p>
</div>
</div>
</div>
<div id="41e63fef" class="cell">
<details class="code-fold">
<summary>Confusion Matrix</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> ISLP <span class="im">import</span> confusion_table</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>confusion_table(y_pred_poly, y_test_sub)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="25">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">Truth</th>
<th data-quarto-table-cell-role="th">0</th>
<th data-quarto-table-cell-role="th">1</th>
<th data-quarto-table-cell-role="th">2</th>
<th data-quarto-table-cell-role="th">3</th>
<th data-quarto-table-cell-role="th">4</th>
<th data-quarto-table-cell-role="th">5</th>
<th data-quarto-table-cell-role="th">6</th>
<th data-quarto-table-cell-role="th">7</th>
<th data-quarto-table-cell-role="th">8</th>
<th data-quarto-table-cell-role="th">9</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">Predicted</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>186</td>
<td>0</td>
<td>2</td>
<td>0</td>
<td>0</td>
<td>4</td>
<td>5</td>
<td>0</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>0</td>
<td>222</td>
<td>2</td>
<td>1</td>
<td>0</td>
<td>3</td>
<td>0</td>
<td>6</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2</td>
<td>1</td>
<td>179</td>
<td>3</td>
<td>5</td>
<td>0</td>
<td>0</td>
<td>6</td>
<td>2</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1</td>
<td>0</td>
<td>7</td>
<td>191</td>
<td>0</td>
<td>2</td>
<td>1</td>
<td>1</td>
<td>8</td>
<td>3</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>173</td>
<td>1</td>
<td>4</td>
<td>0</td>
<td>3</td>
<td>8</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>4</td>
<td>1</td>
<td>156</td>
<td>3</td>
<td>0</td>
<td>4</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>0</td>
<td>4</td>
<td>2</td>
<td>1</td>
<td>4</td>
<td>3</td>
<td>187</td>
<td>0</td>
<td>4</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>3</td>
<td>0</td>
<td>1</td>
<td>4</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>179</td>
<td>2</td>
<td>7</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>3</td>
<td>3</td>
<td>0</td>
<td>0</td>
<td>174</td>
<td>3</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>6</td>
<td>1</td>
<td>0</td>
<td>4</td>
<td>0</td>
<td>192</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="45681437" class="cell">
<details class="code-fold">
<summary>Classification Report</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> classification_report, accuracy_score</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a><span class="co"># accuracy</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Predictive Accuracy:"</span>, accuracy_score(y_test_sub, y_pred_poly))</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a><span class="co"># classification report: one-versus-all</span></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Classification Report:</span><span class="ch">\n</span><span class="st">"</span>, classification_report(y_test_sub, y_pred_poly))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Predictive Accuracy: 0.9195

Classification Report:
               precision    recall  f1-score   support

           0       0.93      0.96      0.95       193
           1       0.94      0.97      0.95       230
           2       0.90      0.92      0.91       195
           3       0.89      0.93      0.91       206
           4       0.91      0.90      0.91       192
           5       0.91      0.90      0.90       173
           6       0.91      0.94      0.92       200
           7       0.91      0.91      0.91       196
           8       0.94      0.87      0.91       199
           9       0.94      0.89      0.91       216

    accuracy                           0.92      2000
   macro avg       0.92      0.92      0.92      2000
weighted avg       0.92      0.92      0.92      2000
</code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="other-model-families" class="level1">
<h1>Other Model Families</h1>
<p>선형모델을 확장한 다양한 모델들이 존재</p>
<ul>
<li>Robust linear models: 중심에서 먼 outlier에 대한 잔차의 영향을 줄여서 파라미터를 추정</li>
<li>Penalised linear models: 파라미터에 제한을 두어 estimation. 예를 들어, ridge regression, lasso regression</li>
<li>Generalised linear models (GLM): 예를 들어, logistic regression, Poisson regression</li>
<li>Generalised additive models (GAM): GLM을 더 확장하여 각 예측변수에 대해 <em>smooth functions</em>를 사용하여 nonlinear 관계를 모델링
<ul>
<li><span class="math inline">\(g(E(Y | X)) = \beta_0 + f_1(X_1) + f_2(X_2) + f_3(X_1, X_2)\)</span></li>
<li>Basis functions도 그 일종임</li>
<li>Splines, loess, smoothing splines 등</li>
</ul></li>
</ul>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/dgds101\.modellings\.art");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
          // target, if specified
          link.setAttribute("target", "_blank");
          if (link.getAttribute("rel") === null) {
            link.setAttribute("rel", "noopener");
          }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../contents/knn.html" class="pagination-link" aria-label="K-Nearest Neighbors">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">K-Nearest Neighbors</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../contents/lda.html" class="pagination-link" aria-label="Generative Models">
        <span class="nav-page-text">Generative Models</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>This work © 2024 by Sungkyun Cho is licensed under CC BY-NC-SA 4.0</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>
<script>var lightboxQuarto = GLightbox({"closeEffect":"zoom","descPosition":"bottom","loop":false,"openEffect":"zoom","selector":".lightbox"});
(function() {
  let previousOnload = window.onload;
  window.onload = () => {
    if (previousOnload) {
      previousOnload();
    }
    lightboxQuarto.on('slide_before_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      const href = trigger.getAttribute('href');
      if (href !== null) {
        const imgEl = window.document.querySelector(`a[href="${href}"] img`);
        if (imgEl !== null) {
          const srcAttr = imgEl.getAttribute("src");
          if (srcAttr && srcAttr.startsWith("data:")) {
            slideConfig.href = srcAttr;
          }
        }
      } 
    });
  
    lightboxQuarto.on('slide_after_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(slideNode);
      }
    });
  
  };
  
})();
          </script>




</body></html>